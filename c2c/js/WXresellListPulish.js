require(["jquery","utils","dot","md5","fastclick"],function(a,b,c,d,e){"use strict";var f={skuId:b.getUrlParam("skuId"),orderId:b.getUrlParam("orderId"),commodityTitle:"",productPrice:"",pic:"",pin:"",verifyAuthUser:"",dateSubmit:"",classId:"",consumeLevel:"",commodityId:"",lat:b.getParameter("lat"),lon:b.getParameter("lon"),provinceId:"",cityId:"",districtId:"",classParentId:""},g=window.screen.height,h=!0,i=!0,j=!0,k={init:function(){k.getWhere(),k.getResellList(),k.inquiryGoldClick(),a(".ui-btn-fixd").show(),1==b.getDevicesType()?a(".ui-btn-fixd").show():2==b.getDevicesType()&&"812"==g&&(a(".ui-btn-fixd").show(),a(".ui-btn-fixd").css("bottom","34px"))},para:{firstTime:0},wxTypeForJD:function(){var a="h5",b=(navigator.userAgent.toLowerCase(),navigator.userAgent),c=b.indexOf("Android")>-1||b.indexOf("Linux")>-1,d=!!b.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return c?a="toast-lighter":d&&(a="toast-lighter2"),a},getWhere:function(){var a={url:b.getHost()+"/position/getLocationByLatLngOrIp",data:{lat:f.lat,lng:f.lon}};b.load(a).then(function(a){b.log("经纬度获取地理位置"+JSON.stringify(a)),console.log(a),"0"===a.code?(f.provinceId=a.data.provinceId,f.cityId=a.data.cityId,f.districtId=a.data.districtId):b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("获取地理位置异常")},function(a){})},getStrLength:function(a){for(var b=0,c=a.length,d=-1,e=0;c>e;e++)d=a.charCodeAt(e),b+=d>=0&&128>=d?1:2;return b},getResellList:function(){var c={url:b.getHost(1)+"/order/publishCommodityQuery",data:{skuId:f.skuId||"",orderId:f.orderId||""}};b.load(c).then(function(c){b.log("获取发布中间页"+JSON.stringify(c)),console.log(c),"0"===c.code?(a(".ui-btn-fixd").unbind("click").bind("click",function(){var c=(new Date).getTime(),d=k.para.firstTime;if(c-d>300){k.para.firstTime=c;var e=/^[0-9]\d*\.{0,1}\d{0,2}$/,f=a("#price").val();""==f?i&&(i=!1,b.lightToast("价格不能为空"),setTimeout(function(){i=!0},2e3)):e.test(f)?k.getResellPulish():(a("#price").val(""),i&&(i=!1,b.lightToast("请输入正确的价格"),setTimeout(function(){i=!0},2e3)))}else{var e=/^[0-9]\d*\.{0,1}\d{0,2}$/,f=a("#price").val();""==f?i&&(i=!1,b.lightToast("价格不能为空"),setTimeout(function(){i=!0},2e3)):e.test(f)?k.getResellPulish():(a("#price").val(""),i&&(i=!1,b.lightToast("请输入正确的价格"),setTimeout(function(){i=!0},2e3)))}}),f.classId=c.data.classId||"",f.pin=b.getJdPin("pwdt_id"),k.getStrLength(c.data.productName)>30?f.commodityTitle=c.data.productName.substring(0,30)+"...":f.commodityTitle=c.data.productName,f.verifyAuthUser=c.data.verifyAuthUser,f.productPrice=c.data.productPrice,f.dateSubmit=c.data.dateSubmit,f.classId=c.data.classId,f.classParentId=c.data.classParentId,f.pic=c.data.imgUrl,a(".ui-middle img").attr("src",getImageHost()+"/paipai/s120x120_"+c.data.imgUrl+"!cc_1x1"),a(".ui-goods-detail").html("【京东转卖】"+c.data.productName),a(".price").html(c.data.productPrice)):b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("获取一键转卖列表异常")},function(a){})},getResellPulish:function(){var c={url:b.getHost()+"/commodity/v1/resaleCommodity",data:{commodityTitle:"【京东转卖】"+f.commodityTitle,originalCost:f.productPrice,pic:f.pic,commodityType:0,commoditySource:1,transactionMode:0,sellPrice:a("#price").val(),shippingfee:a("#youfei").val()||0,descType:0,charactersDesc:"京东正规渠道购买，正品保障，欢迎咨询",isCalled:0,invoiceType:1,devicesType:0,optSource:1,orderCode:f.orderId,mainPic:f.pic,provinceId:f.provinceId||"",cityId:f.cityId||"",districtId:f.districtId,orderCommodityId:f.skuId,orderTime:f.dateSubmit,securityKey:hex_md5("$JD_@ERSHOU_#PUBLISH_01_"+decodeURIComponent(f.pin)+"_【京东转卖】"+f.commodityTitle+"_"+f.classId),classId:f.classId,jDResaleFlag:"true",tel:"",lat:f.lat,lon:f.lon,consumeLevel:f.consumeLevel||0}};b.load(c).then(function(a){b.log("获取发布发布商品接口"+JSON.stringify(a)),console.log(a),"0"===a.code?(console.log(a.data.verifyAuthUser),f.commodityId=a.data.commodityId,f.consumeLevel=a.data.consumeLevel,"true"==a.data.verifyAuthUser?(b.lightToast("发布成功"),setTimeout(function(){location.replace("goodsDetail.html?itemid="+f.commodityId)},1e3)):location.replace("goodsDetail.html?itemid="+f.commodityId+"&nameurl="+encodeURIComponent(a.data.realNameIdentifyUrl))):b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("获取发布商品列表异常")},function(a){})},inquiryGoldClick:function(){var b=/^[0-9]\d*\.{0,1}\d{0,2}$/,c=/^[0-9]\d*$/;a(".ui-left-price").delegate("#price","input",function(){var c=a(this).val();if(b.test(c))if(c>9999999.99){var d=a('<div class="'+k.wxTypeForJD()+'">最大不能超过一千万</div>');a("body").append(d),h&&(h=!1,d.hasClass("show")||(setTimeout(function(){d.addClass("show")},0),setTimeout(function(){d.removeClass("show"),h=!0},2e3))),a(this).val("")}else c.length>1&&"0"===c.substring(0,1)&&"."!==c.substring(1,2)&&(c=c.substring(1,c.length),a(this).val(c));else{var d=a('<div class="'+k.wxTypeForJD()+'">仅支持数字格式</br>（保留小数点后两位）</div>');a("body").append(d),h&&(h=!1,d.hasClass("show")||(setTimeout(function(){d.addClass("show")},0),setTimeout(function(){d.removeClass("show"),h=!0},2e3))),a(this).val("")}}),a(".ui-left-send").delegate("#youfei","input",function(){var b=a(this).val();if(c.test(b))if(b>999.99){var d=a('<div class="'+k.wxTypeForJD()+'">最大不能超过一千</div>');a("body").append(d),j&&(j=!1,d.hasClass("show")||(setTimeout(function(){d.addClass("show")},0),setTimeout(function(){d.removeClass("show"),j=!0},2e3))),a(this).val("")}else b.length>1&&"0"===b.substring(0,1)&&"."!==b.substring(1,2)&&(b=b.substring(1,b.length),a(this).val(b));else{var d=a('<div class="'+k.wxTypeForJD()+'">邮费仅支持整数</div>');a("body").append(d),j&&(j=!1,d.hasClass("show")||(setTimeout(function(){d.addClass("show")},0),setTimeout(function(){d.removeClass("show"),j=!0},2e3))),a(this).val("")}})}};k.init()});