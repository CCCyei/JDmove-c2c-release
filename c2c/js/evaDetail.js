require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={init:function(){d.initPara(function(){d.getCommentList(),a(".eva-add").show()})},para:{orderId:"",commentId:""},localObj:{isShow:0},initPara:function(a){var c=b.getParameter("orderId")||"",e=b.getParameter("commentId")||"";return c||e?(d.para.orderId=c,d.para.commentId=e,void a()):void b.lightToast("缺少参数")},addClick:function(){a(".order-btn-bottom span").click(function(){if(1==d.localObj.isShow){var a="?orderId="+d.para.orderId;b.goUrl("/assessEdit.html"+a)}else if(2==d.localObj.isShow){var a="?parentId="+d.para.commentId+"&orderId="+d.para.orderId;b.goUrl("/assessAdd.html"+a)}}),a(".eva-conic-img img").click(function(){if("yes"==b.getParameter("ism"));else{for(var c=a(this).parents("ul").children(),d=a(this).parent().attr("data-index"),e=[],f=a(this).parents("ul").children().length,g=0;f>g;g++)e.push(c.eq(g).children().attr("data-src"));var h={pics:e,index:d},i="openapp.paipai://showBigPic/app?param="+encodeURIComponent(JSON.stringify(h));location.href=i}})},renderProductInfo:function(d){d.buyerConfirmTime=d.buyerConfirmTime?b.formatDate(d.buyerConfirmTime):"--",a(".eva-top").show(),a(".eva-top").html(c.template(a(".product-info").text())(d)),a(".eva-bottom").show()},renderMain:function(b){a(".eva-content-main").append(c.template(a(".main-comment").text())(b))},renderSub:function(b){a(".eva-content-sub").append(c.template(a(".sub-comment").text())({array:b}))},getCommentList:function(){var c={url:b.getHost()+"/orderComment/list",data:d.para};b.load(c).then(function(c){if(c&&0==c.code)if(c.data&&b.isNotEmpty(c.data)){var e=c.data,f=getImageHost()+"/paipai/s160x160_",g=a.extend({},e.commodityResp,e.dealResp);if(g&&b.isNotEmpty(g)?(g.pic=g.pic?f+g.pic+"!cc_1x1":"",d.renderProductInfo(g)):a(".eva-top").hide(),e.buyCommentOrder&&b.isNotEmpty(e.buyCommentOrder)){var h=e.buyCommentOrder;d.para.orderId=d.para.orderId||h.orderId||"",d.para.commentId=d.para.commentId||h.commentId||"",h.pic=JSON.parse(h.pic||"[]"),h.icon=h.icon?getImageIcon("/paipai/s80x80_",h.icon,"!cc_1x1"):"",d.renderMain(h)}if(e.sellerCommentOrder&&b.isNotEmpty(e.sellerCommentOrder)){var i=e.sellerCommentOrder;d.para.orderId=d.para.orderId||i.orderId||"",d.para.commentId=d.para.commentId||i.commentId||"",i.pic=JSON.parse(i.pic||"[]"),i.icon=i.icon?getImageIcon("/paipai/s80x80_",i.icon,"!cc_1x1"):"",d.renderMain(i)}if(void 0!=e.trackCount&&e.trackCount>0&&a(".eva-add").show().html("追评·"+e.trackCount),e.result&&e.result.length){var j=e.result;(j||[]).forEach(function(a){a.pic=JSON.parse(a.pic||"[]"),a.icon=a.icon?getImageIcon("/paipai/s80x80_",a.icon,"!cc_1x1"):""}),d.renderSub(j)}d.localObj.isShow=e.isShow,1==e.isShow?(a(".order-btn-bottom span").text("发布评价"),a(".order-btn-bottom").show()):2==e.isShow&&(a(".order-btn-bottom span").text("发布追评"),a(".order-btn-bottom").show()),d.addClick()}else b.lightToast("评论信息异常");else b.lightToast(c.tip||"网络异常，稍后重试")},function(a){b.lightToast("网络异常，稍后重试")})}};d.init()});