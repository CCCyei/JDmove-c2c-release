require(["jquery","utils","dot"],function(a,b,c){window.imgObj={};var d={init:function(){d.getAesKey(function(){d.getUinInfo(),d.addClick()})},para:{addressInfo:"",icon:"",aesKey:""},getAesKey:function(a){var c={url:b.getHost()+"/security/aesKey",data:{}};b.load(c).then(function(c){c&&0==c.code?d.para.aesKey=c.data:b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("解密key异常"),a()},function(b){a()})},decrypt:function(a,b){var c=CryptoJS.enc.Utf8.parse(b),d=CryptoJS.AES.decrypt(a,c,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return CryptoJS.enc.Utf8.stringify(d).toString()},addClick:function(){a(".userNick").unbind("click").bind("click",function(){b.goUrl("/userNickSetting.html?type=updata&nickName="+a("#userNickInput").val()+"&editAbleNickName="+a(this).attr("editAbleNickName")+"&lastNickNameTime="+a(this).attr("lastNickNameTime"))}),a(".userAddress").unbind("click").bind("click",function(){b.goUrl("/addrManger.html?backUrl=/userSetting.html")}),a(".signOut").unbind("click").bind("click",function(){location.href="openapp.paipai://logOut/app"}),a(".no-address").unbind("click").bind("click",function(){b.goUrl("/addrManger.html?backUrl=/userSetting.html")}),a(".leftImg").delegate(".img-box","click",function(){var a={num:1,ishead:!0},b="openapp.paipai://takePhotos/app?param="+encodeURIComponent(JSON.stringify(a));location.href=b}),window.renderPhotos=function(b,c){imgObj[b]=c,a(".userHead").attr("src","data:image/jpeg;base64,"+c),a(".reverse-upload-loading").removeClass("hide")},window.uploadPhotoSuccess=function(a,b){imgObj[a]&&d.getUpdateAvatar(b)},window.uploadPhotoFail=function(c){imgObj[c]&&(a(".reverse-upload-loading").addClass("hide"),a(".userHead").attr("src",getImageIcon("/paipai/s160x160_",d.para.icon,"!cc_1x1")),b.lightToast("修改头像失败~"))}},getDefaultPara:function(){d.para.addressInfo=b.getParameter("addressInfo"),b.isNotEmpty(d.para.addressInfo)?a(".addressDetail").text(d.para.addressInfo):setTimeout(function(){d.getDefaultAddress()},100)},getUpdateAvatar:function(c){var e={url:b.getHost()+"/user/updateAvatar",data:{pic:c,protocol:location.protocol.indexOf("https")>-1?2:1},type:"POST",dataType:"json",checkLogin:!0};b.load(e).then(function(c){b.isNotEmpty(c)&&"0"==c.code?(a(".reverse-upload-loading").addClass("hide"),location.href="openapp.paipai://changeNickname/app",d.getUinInfo()):(a(".reverse-upload-loading").addClass("hide"),a(".userHead").attr("src",getImageIcon("/paipai/s160x160_",d.para.icon,"!cc_1x1")),b.lightToast(c.tip))},function(c){a(".reverse-upload-loading").addClass("hide"),a(".userHead").attr("src",d.para.icon),b.lightToast("接口异常")})},getUinInfo:function(){var c={url:b.getHost()+"/user/getUserByUin",data:{}};b.load(c).then(function(c){b.isNotEmpty(c)&&"0"==c.code?(d.para.icon=c.data.icon,a(".userHead").attr("src",getImageIcon("/paipai/s160x160_",c.data.icon,"!cc_1x1")),a("#userNameInput").val(c.data.jdPin),a("#userNickInput").val(c.data.nickname),a(".userNick").attr("editAbleNickName",c.data.editAbleNickName),a(".userNick").attr("lastNickNameTime",c.data.lastNickNameTime),"0"==c.data.sex?a("#userSexInput").val("男"):"1"==c.data.sex?a("#userSexInput").val("女"):"2"==c.data.sex&&a("#userSexInput").val("未知"),a("#userBirthdayInput").val(c.data.birthday)):b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("拉取信息失败~"),d.getDefaultPara()},function(a){b.lightToast("拉取信息异常"),d.getDefaultPara()})},getDefaultAddress:function(){var c={url:b.getHost()+"/receiveAddr/secGetDefaultReceiveAddr",data:{}};b.load(c).then(function(c){if(b.isNotEmpty(c)&&"0"==c.code&&d.para.aesKey)if(b.isNotEmpty(c.data)){var e=c.data.fullAddress;a(".no-address").addClass("hide"),a(".userAddress").removeClass("hide"),a(".addressDetail").text(d.decrypt(e,d.para.aesKey)||e)}else a(".userAddress").addClass("hide"),a(".no-address").removeClass("hide");else a(".userAddress").addClass("hide"),a(".no-address").removeClass("hide")},function(b){a(".userAddress").addClass("hide"),a(".no-address").removeClass("hide")})}};d.init()});