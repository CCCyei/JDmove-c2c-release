!function(){function a(a){document.body.scrollTop=document.documentElement.scrollTop=a}function b(){return document.body.scrollTop||document.documentElement.scrollTop}var c=0;open.onclick=function(){c=b(),document.body.classList.add("dialog-open"),document.body.style.top=-c+"px",mask.style.display="block"},close.onclick=function(){mask.style.display="none",document.body.classList.remove("dialog-open"),a(c)}}();var commonPara,commonBiz;window.setCommonParams=function(a){commonPara=a,commonBiz.getPayInfo()};var commonMoney="";require(["jquery","jweixin","utils","dot","paipaiSDK","ext"],function(a,b,c,d,e,f){"use strict";var g={id:"select-reason",title:"取消原因",arr:[{name:"与卖家协商一致",value:1},{name:"卖家未发货",value:2},{name:"信息填写错误重新拍",value:3},{name:"卖家商品无货",value:4},{name:" 拍错 / 误点",value:5},{name:"不想要了",value:6},{name:"其他",value:7}]},h={id:"select-reason",title:"取消原因",arr:[{name:"与买家协商一致",value:1},{name:"商品无货",value:2},{name:"不想卖了",value:3},{name:"拍错/误点",value:4},{name:"其他",value:5}]},i=c.getParameter("isJdWx"),j=c.getParameter("ism")||"",k={para:{aesKey:"",dealId:c.getParameter("dealId"),data:"",sellerUin:"",userFlag:",",orderState:"",refundid:"",dealStateDesc:"",operButtonsList:[],commodityId:"",targetUin:"",token:c.getParameter("token"),confimId:c.getParameter("confimId"),onece:!1,repairDetailUrl:"",repairRequestUrl:"",commoditySource:"",jdOrderCode:"",scrollY:0,classId:"",serials:[],repairAd:"",invoiceUrlList:[],dealType:""},initPara:function(a){c.isNotEmpty(k.para.dealId)||c.log("订单参数不能为null"),a()},orderId:c.getParameter("orderId"),getOpenActivityOpt:function(){var a=location.protocol+"//paipai.m.jd.com/c2c/orderDetail.html?dealId="+k.para.dealId,b={key1:a},c="openapp.paipai://openActivity/app?param="+encodeURIComponent(JSON.stringify(b));return c},init:function(){3==c.getType(),!k.para.onece&&k.para.token&&k.para.confimId&&(k.para.onece=!0,this.orderMeetConfirmReceived(k.para.token,k.para.confimId),history.replaceState("","","/c2c/orderDetail.html?dealId="+k.para.dealId)),k.getAesKey(function(){k.initPara(function(){if(k.getDealDetail(k.para.dealId),k.getIsBuyer(),"yes"==i&&3===c.getType()){k.defaultOpt.scheme_Adr=k.getOpenActivityOpt(),f.init(k.defaultOpt),a(".ui-down").css("top",0),window.guessyoulikeConfig={type:2,curtab:2,container:"#isJdWx"};var b="var _M={},require=function(id){if(!_M[id]){_M[id]={exports:{}}}return _M[id].exports},define=function(id,fun){_M[id]={exports:{}};var o=fun(require,_M[id].exports,_M[id]);_M[id].exports=o||_M[id].exports};function modulejs(deps,factory){var isEmptyObject=function(obj){var name;for(name in obj){return false}return true};var main=require(deps);!isEmptyObject(main)&&factory(main)};",d=document.getElementsByTagName("head")[0],e=document.createElement("script");e.setAttribute("type","text/javascript"),e.appendChild(document.createTextNode(b)),d.appendChild(e);var d=document.getElementsByTagName("head")[0],e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","//wq.360buyimg.com/js/version/201808/allinonemin/wg.guessyoulike.20180829162424.js"),d.appendChild(e),e.onload=e.onreadystatechange=function(){console.log("加载完成"),e.onload=e.onreadystatechange=null},a(".orderDetail-box").unbind("click").bind("click",function(){if(1==c.getDevicesType())c.openApp(k.getOpenActivityOpt()),event.stopPropagation();else{var a="openapp.paipai://openWeb/app?param="+encodeURIComponent(JSON.stringify({query:{url:"paipai.m.jd.com"+location.pathname,isJdWx:"yes",dealId:k.para.dealId},type:1}));c.openApp(a),event.stopPropagation()}})}else k.addClick();a(".img-close").click(function(){a(".ui-warning").hide(),a(".order-topwx").css({"margin-top":"0"})})})})},defaultOpt:{scheme_IOS:"openapp.paipai://openWeb/app?param="+encodeURIComponent(JSON.stringify({query:{url:"paipai.m.jd.com"+location.pathname,isJdWx:"yes",dealId:c.getParameter("dealId")},type:1})),scheme_Adr:"openapp.paipai://openActivity/app?param="+encodeURIComponent(JSON.stringify({key1:"paipai.m.jd.com"+location.pathname+"?dealId="+c.getParameter("dealId")}))},decrypt:function(a,b){var c=CryptoJS.enc.Utf8.parse(b),d=CryptoJS.AES.decrypt(a,c,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return CryptoJS.enc.Utf8.stringify(d).toString()},bodyScollHandler:function(){if(a(".bGView").is(":visible")){var b=a(window).height();a("body,html").css({overflow:"hidden",height:b+"px"})}else a("body,html").css({overflow:"auto",height:"auto"})},warn:function(){"wx"==c.getLoginCodeType()&&"miniprogram"!==window.__wxjs_environment?"yes"==i?a(".ui-warning").show():(a(".ui-warning").show(),a(".order-btn-bottom").hide(),a(".order-btn-bottom2").hide(),a(".order-link-right").hide()):1==k.para.userFlag?3==k.para.orderState||7==k.para.orderState?(a(".ui-warning").show(),a(".img-warn").css({top:"0.42643923rem"}),a(".img-close").show().css({top:"0.42643923rem"}),a(".warn").html("防骗小贴士：为保护您的权益，收到商品前万万不要点击确认收货！"),a(".order-topwx").css({"margin-top":"1.28rem"})):0==k.para.orderState||1==k.para.orderState||2==k.para.orderState?(a(".ui-warning").show(),a(".img-close").show(),a(".warn").html("防骗小贴士：请不要进行私下交易，谨防上当受骗！")):(a(".ui-warning").hide(),a(".img-close").hide(),a(".order-topwx").css({"margin-top":"0rem"})):3==k.para.orderState||7==k.para.orderState||0==k.para.orderState||1==k.para.orderState?(a(".ui-warning").show(),a(".img-close").show(),a(".warn").html("防骗小贴士：请不要进行私下交易，谨防上当受骗")):2==k.para.orderState?1===k.para.dealType?(a(".ui-warning").show(),a(".img-warn").css({top:"0.42643923rem"}),a(".img-close").show().css({top:"0.42643923rem"}),a(".order-topwx").css({"margin-top":"1.28rem"}),a(".warn").html("由于卖家不发货至交易关闭的行为，将扣除所售物品金额的20％拍币作为违约金，请您及时发货")):(a(".ui-warning").show(),a(".img-close").show(),a(".warn").html("防骗小贴士：请不要进行私下交易，谨防上当受骗！")):(a(".ui-warning").hide(),a(".img-close").hide(),a(".order-topwx").css({"margin-top":"0rem"}))},initPayPar:function(){2==c.getType()?window.webkit.messageHandlers.AppWindControlModel.postMessage(1):location.href="openapp.paipai://fengkong/app"},initReason:function(){setTimeout(function(){var b;b=k.getIsBuyer()?g:h,c.selectFloat(b,function(b){var c=a(b).html(),d=a(b).data("value");k.getIsBuyer()?k.cancelDeal(c,k.para.dealId,d):1==k.para.orderState?k.cancelDeal(c,k.para.dealId,d):k.cancelDeal4Refund(c,k.para.dealId,d)})},1e3)},addClick:function(){a(".jd-weixiu-w").unbind("click").bind("click",function(){var a="/shouhou/channel";location.href=a,c.addMping({event_id:"paipai_1533541842166|2",event_level:"",event_param:"'orderId':"+k.para.dealId+",'category_id':"+k.para.classId})}),a(".order-orderInfo").off("click").on("click",".zaibao-tip",function(b){a(".zaibao-tip").toggleClass("zaibao-tip-show")}),a(".device-dialog-close").unbind("click").bind("click",function(){a(".device-dialog-wrap").hide(),console.log(k.para.scrollY),window.scrollTo(0,k.para.scrollY),a("html").removeClass("fixed")}),a(".ui-order-product").off("click").on("click",function(){if(c.isNotEmpty(k.para.commodityId))if(2==k.para.commoditySource){var a="/c2c/m/popGoodsDetail?commodityId="+k.para.commodityId+"&refresh=no";c.goUrl(a)}else if(3==c.getType()){var a="/goodsDetail.html?ism=yes&itemid="+k.para.commodityId;c.goUrl(a)}else location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":"'+k.para.commodityId+'"}';else console.log("商品为空")}).on("click",".device-btn",function(b){b.stopPropagation(),k.para.scrollY=window.pageYOffset,a(".device-dialog-wrap").show(),a("html").addClass("fixed"),c.addMping({event_id:"paipai_1533541842166|4",event_level:"",event_param:"'orderId':"+k.para.dealId+",'serialsNumber':"+k.para.serials.length+",'category_id':"+k.para.classId})}).on("click",".invoice-btn",function(a){a.stopPropagation(),k.getResellList(k.para.jdOrderCode),c.addMping({event_id:"paipai_1533541842166|3",event_level:"",event_param:"'orderId':"+k.para.dealId})}),a(".order-btn-bottom .order-bb-right").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".order-btn-bottom .order-bb-left").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".order-btn-bottom2").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".order-btn-bottom3 .order-bb-left").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".order-btn-bottom3 .order-bb-center").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".order-btn-bottom3 .order-bb-right").unbind("click").bind("click",function(){var b=a(this).data("reqtype");k.btnHandler(b)}),a(".bGView .cancelBtn").unbind("click").bind("click",function(){a(".bGView").addClass("ui-hide"),k.bodyScollHandler()}),a(".bGView .confirmBtn").unbind("click").bind("click",function(){k.bodyScollHandler(),k.alterDealPrice()}),a(".bGView .clear").unbind("click").bind("click",function(){a(this).parent().find("input").val("")}),a(".bGView").unbind("click").bind("click",function(){c.log("执行了"),a(this).addClass("ui-hide"),k.bodyScollHandler()}),a(".changePriceView").unbind("click").bind("click",function(a){a.stopPropagation()}),a(".reverse-dialog").unbind("click").bind("click",function(b){a(".reverse-dialog").hide()}),a("#cancel").unbind("click").bind("click",function(b){b.stopPropagation(),a(".reverse-dialog").hide()}),a("#success").unbind("click").bind("click",function(a){a.stopPropagation(),k.confirmReceived()}),a("#delySuccess").unbind("click").bind("click",function(b){b.stopPropagation(),a(".reverse-dialog-dely").hide(),k.extendGoods(k.para.dealId)}),a("#delyCancel").unbind("click").bind("click",function(b){b.stopPropagation(),a(".reverse-dialog-dely").hide()}),a(".order-link-right").unbind("click").bind("click",function(){var b=a(this).data("sku"),d=a(this).data("uin");c.log("sku"+b),c.log("uin"+d);var e={sku:b,uin:d};if(3==c.getType())c.goUrl("/chat/im?otherUin="+d+"&pid="+b);else{var f="openapp.paipai://im/app?param="+encodeURIComponent(JSON.stringify(e));location.href=f}})},btnHandler:function(d){if("cancel"==d)a("#select-reason").show();else if("pay"==d){if("miniprogram"===window.__wxjs_environment)return void b.miniProgram.redirectTo({url:"/pages/pay/pay?type=c2c&orderid="+k.para.dealId+"&num="+commonMoney});3!=c.getType()?k.initPayPar():k.getPayInfo()}else if("alterPrice"==d)a(".nameStr").html(k.para.data.commodityName),a("#editDeliveryPriceInput").val(k.para.data.dealPayFeeShipping?parseInt(k.para.data.dealPayFeeShipping,10):""),k.para.data.dealPayFee>0?a("#editPriceInput").val(k.para.data.dealPayFee):a("#editPriceInput").val(0),k.changePrice(k.para.dealId);else if("urge"==d)k.reminderDeal();else if("remindReceive"==d)k.reminderDeal();else if("refund"==d)c.goUrl("/applyRefund.html?dealId="+k.para.dealId);else if("delivery"==d){var e="/c2c/orderDetail.html?dealId="+k.para.dealId;c.goUrl("/deliverGoods.html?dealId="+k.para.dealId+"&backUrl="+encodeURIComponent(e))}else"confirmDelivery"==d?a(".reverse-dialog").show():"lookComment"==d?c.goUrl("/evaDetail.html?orderId="+k.para.dealId):"comment"==d?c.goUrl("/assessEdit.html?orderId="+k.para.dealId):"lookPay"==d?c.goUrl("/c2c/mine/bill-detail?dealId="+k.para.dealId):"lookRefund"==d?c.goUrl("/refundDetail.html?dealId="+k.para.dealId):"help"==d?c.goUrl("//dd1-m.jd.com/chat/index.action?venderId=1&appId=jd.waiter&customerAppId=im.customer&entry=jd_m_paipai"):"applyaftersale"==d?c.goUrl("/chat/im?otherUin="+k.para.targetUin+"&pid="+k.para.commodityId):"delay"==d?a(".reverse-dialog-dely").show():"lookPayQR"==d?c.goUrl("/c2c/chat/paycode?dealId="+k.para.dealId):"receiveMoney"==d?this.orderScanRcode():"repairDetail"==d?(location.href=k.para.repairDetailUrl,c.addMping({event_id:"paipai_1533541842166|5",event_level:"",event_param:"'orderId':"+k.para.dealId+",'commoditySource':"+(k.para.commoditySource?1:0)+",'buttonType':0"})):"applyRepair"==d&&(c.addMping({event_id:"paipai_1533541842166|5",event_level:"",event_param:"'orderId':"+k.para.dealId+",'commoditySource':"+(k.para.commoditySource?1:0)+",'buttonType':1"}),location.href="//"+k.para.repairRequestUrl)},orderScanRcode:function(){var a={url:c.getHost(1)+"/order/v1/deal/scanQRCode",data:{dealId:k.para.dealId}};c.load(a).then(function(a){a&&0==a.code?e.get.scanQRCode(function(a){if(a&&c.getLoctionUrlParam(a,"dealId")&&c.getLoctionUrlParam(a,"token")){var b=c.getLoctionUrlParam(a,"dealId"),d=c.getLoctionUrlParam(a,"token");k.orderMeetConfirmReceived(d,b)}else c.lightToast("没有找到对应的商品哦~")}):c.lightToast(a.tip||"网络异常")})},orderMeetConfirmReceived:function(a,b){var d={url:c.getHost(1)+"/order/v1/deal/faceToFaceConfirmReceived",type:"POST",data:{dealId:b,machineKey:"test",token:a}};c.load(d).then(function(a){0==a.code?(c.lightToast(a.tip||"已成功收款"),k.init()):c.lightToast(a.tip||"网络异常")})},changePrice:function(b){var d={url:c.getHost(1)+"/order/v1/deal/checkChangePrice",data:{dealId:b}};c.load(d).then(function(b){c.log("能不能修改价格"+JSON.stringify(b)),b&&0==b.code?(a(".bGView").removeClass("ui-hide"),k.bodyScollHandler()):b&&738==b.code?(a(".reverse-dialog-edit").show(),a(".reverse-dialog-panel-tishi").html(b.tip),a(".reverse-dialog-edit #success").click(function(){a(".reverse-dialog-edit").hide()})):c.isNotEmpty(b.tip)?c.lightToast(b.tip):c.lightToast("修改价格异常")},function(a){})},getAesKey:function(a){var b={url:c.getHost()+"/security/aesKey",data:{}};c.load(b).then(function(b){b&&0==b.code?k.para.aesKey=b.data:c.isNotEmpty(b.tip)?c.lightToast(b.tip):c.lightToast("解密key异常"),a()},function(b){a()})},getRefreshPrice:function(b){var d={url:c.getHost(1)+"/order/v1/deal/getDealFeeList",data:{ids:b}};c.load(d).then(function(d){d&&"0"===d.code?(a(".order-bi-right span").eq(0).html(d.data[b].dealPayFeeShipping),a(".order-bi-right span").eq(1).html(d.data[b].dealPayFeeTotal),a(".ui-opl-bottom").html("<i>&yen;</i>"+d.data[b].dealPayFeeCommodity),a("#editDeliveryPriceInput").val(d.data[b].dealPayFeeShipping?parseInt(d.data[b].dealPayFeeShipping,10):""),a("#editPriceInput").val(d.data[b].dealPayFeeTotal)):c.isNotEmpty(d.tip)?c.lightToast(d.tip):c.lightToast("刷新价格异常")},function(a){c.lightToast("网络异常，稍后重试")})},reportPayInfo:function(a){var b=c.getParameter("payTag");if(c.isNotEmpty(b)&&"1"==b&&a&&0==a.code){console.log("去上报");var d=a.data;d&&("0"==d.commoditySource?c.addMping({event_id:"PaiPai_1527823553984|28",event_level:"",event_param:"",page_name:"C2C个人闲置支付成功页"}):"1"==d.commoditySource&&(c.addMping({event_id:"PaiPai_1527823553984|29",event_level:"",event_param:"",page_name:"C2C一键转卖支付成功页"}),"1"==d.isViewOriginalInfo&&c.addMping({event_id:"PaiPai_1527823553984|27",event_level:"",event_param:"",page_name:"展示京东订单信息商品的支付成功页"})))}},getResellList:function(a){var b={url:c.getHost()+"/invoice/query",data:{orderId:a}};c.load(b).then(function(a){c.log("获取发票"+JSON.stringify(a)),console.log(a),"0"===a.code?(console.log(a.data[0]),location.href=a.data[0]):c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("获取发票异常")},function(a){})},getDealDetail:function(b){var d={url:c.getHost(4)+"/order/v1/deal/secGetDealDetail",data:{dealId:b}};c.load(d).then(function(b){if(b&&0==b.code){k.reportPayInfo(b),c.log("订单详情信息"+JSON.stringify(b)),k.para.dealType=b.data.dealType,1==b.data.dealType?a(".soldPrice").addClass("hide"):a(".soldPrice").removeClass("hide"),k.renderProductInfo(b.data),k.renderAddrInfo(b.data),k.para.sellerUin=b.data.sellerUin,k.para.orderState=b.data.dealState,k.para.refundid=b.data.refundId,k.para.operButtonsList=b.data.operButtonsList,k.para.dealStateDesc=b.data.dealStateDesc,k.para.targetUin=b.data.targetUin,k.para.commodityId=b.data.commodityId,a(".order-bi-right span").eq(0).html(b.data.dealPayFeeShipping),a(".order-bi-right span").eq(1).html(b.data.dealPayFeeTotal),commonMoney=b.data.dealPayFeeTotal;var d="";if(b.data.deliveryMessage&&c.isNotEmpty(b.data.deliveryMessage.processInfo)&&(d=b.data.deliveryMessage.processInfo,d.indexOf("查询不到")>-1&&(d="物流公司: "+b.data.deliveryCompany+" <br/> 物流单号: "+b.data.deliveryCode),a(".ui-order-state .ui-order-center i").html(d)),c.isNotEmpty(b.data.processDate))a(".ui-order-state .ui-order-center span").html(c.formatDate(b.data.processDate)).show();else{a(".ui-order-state .ui-order-center span").hide();var e="orderTrack.html?wayBillCode="+b.data.deliveryCode+"&logisticsCode="+b.data.deliveryCompanyId;c.isNotEmpty(b.data.pic)&&b.data.pic.length>0&&(e=e+"&mainImgUrl="+encodeURIComponent(b.data.pic[0])),d.indexOf("物流单号")>-1&&(e="javascript:void(0);",a(".ui-order-state .ui-order-right img").css("display","none")),a(".ui-order-state a").attr("href",e)}if(k.para.userFlag=b.data.userFlag,k.warn(),a(".order-orderInfo .order-orderInfo-item span").eq(0).html(b.data.dealId),a(".order-orderInfo .order-orderInfo-item span").eq(1).html(c.formatDate(b.data.dealCreateTime)),c.isNotEmpty(b.data.warrantyDeadline)){var f=new Date(b.data.warrantyDeadline),g=f.getFullYear(),h=f.getMonth()+1,i=f.getDate();h=10>h?"0"+h:h,i=10>i?"0"+i:i;var l=[g,h,i].join("."),m='<div class="order-orderInfo-item zaibao-item"><i>在保期限</i><span>约 '+l+'</span><span class="zaibao-tip"><div class="img"></div></div></span></div>';0==document.getElementsByClassName("zaibao-item").length&&a(".order-orderInfo").append(m)}if(c.isNotEmpty(b.data.repairAd)&&c.isNotEmpty(b.data.repairTextDesc)&&"yes"!==j&&(a(".jd-weixiu-text").html(b.data.repairTextDesc),a(".jd-weixiu-w").show()),c.isNotEmpty(b.data.imShowStr)&&(k.para.imShowStr=b.data.imShowStr),b.data.serials&&(k.para.serials=b.data.serials,k.renderProductSerials(b.data.serials)),c.isNotEmpty(b.data.commoditySource)&&(k.para.commoditySource=b.data.commoditySource),c.isNotEmpty(b.data.classId)&&(k.para.classId=b.data.classId),c.isNotEmpty(b.data.repairDetailUrl)&&(k.para.repairDetailUrl=b.data.repairDetailUrl),c.isNotEmpty(b.data.repairRequestUrl)&&(k.para.repairRequestUrl=b.data.repairRequestUrl),c.isNotEmpty(b.data.jdOrderCode)&&(k.para.jdOrderCode=b.data.jdOrderCode),b.data.deliveryMessage&&c.isNotEmpty(b.data.deliveryMessage)&&(a(".ui-order-state").removeClass("ui-hide"),b.data.deliveryMessage&&b.data.deliveryMessage.processInfo&&c.isNotEmpty(b.data.deliveryMessage.processInfo)&&a(".ui-order-state .ui-orc-top").html(d),b.data.deliveryMessage&&b.data.deliveryMessage.processDate&&c.isNotEmpty(b.data.deliveryMessage.processDate)&&a(".ui-order-state .ui-orc-bottom").html(c.formatDate(b.data.deliveryMessage.processDate))),2==b.data.commoditySource)var n=k.getIsBuyer()?"联系客服":"联系买家";else var n=k.getIsBuyer()?"联系卖家":"联系买家";if(a(".order-link-right span").html(n),a(".order-link-right").data("sku",b.data.commodityId),a(".order-link-right").data("uin",b.data.targetUin),k.getIsBuyer()?a(".order-link-left span").html(b.data.sellerNick):a(".order-link-left span").html(b.data.buyerNick),k.stateHandler(b.data.operButtonsList||[]),2==b.data.mailType?(a("#list-meet").show(),a("#ui-order-address").hide()):a("#list-normal").show(),k.topStateHandler(b.data.dealState,b.data.refundId),k.para.data=b.data,k.initReason(),5==b.data.dealState)if(c.isNotEmpty(b.data.refundId)&&0!=b.data.refundId&&5==b.data.dealState)k.initData();else{if(b.data.timeoutDesc){var o=b.data.dealStateDesc+","+b.data.timeoutDesc;a(".order-top .order-top-tip").html(o)}else a(".order-top .order-top-tip").html(b.data.dealStateDesc);a(".order-top ul").html('<li><img class="img-close" src="image/img-colse.png"></li>'),a(".order-top-tip").css("padding-top","0").css("text-align","center").css("display","block")}else if(102==b.data.dealState||10==b.data.dealState)if(a(".order-top .order-top-tip2").html(""),clearInterval(window.mdmTime),b.data.timeoutDesc){var o=b.data.dealStateDesc+b.data.timeoutDesc,p=b.data.timeoutRemainTime;p&&p>0&&(window.mdmTime=setInterval(function(){p-=1;var b='<i class="red">'+c.restTimeCountDownc2c(p)+"</i>";o=o.replace("${timeout}",b),a(".order-top .order-top-tip2").html(o),a(".order-top-tip2").css("display","block"),a(".order-top-tip").css("display","none"),0>=p&&(clearInterval(window.mdmTime),location.reload())},1e3))}else a(".order-top .order-top-tip").html(b.data.dealStateDesc);else if(c.isNotEmpty(b.data.refundId)&&0!=b.data.refundId&&4==b.data.dealState?k.initData():b.data.timeoutDesc?a(".order-top .order-top-tip").html(b.data.dealStateDesc+","+b.data.timeoutDesc):a(".order-top .order-top-tip").html(b.data.dealStateDesc),b.data.timeoutRemainTime&&b.data.timeoutRemainTime>0)var p=b.data.timeoutRemainTime,q=setInterval(function(){p-=1;var d="<i>"+c.restTimeCountDownc2c(p)+"</i>";d=c.isNotEmpty(b.data.timeoutDesc)?b.data.timeoutDesc.replace("${timeout}",d):"",a(".order-top .order-top-tip2").html("<span>"+d+"</span>"),0>=p&&(clearInterval(q),location.reload())},1e3);1==k.para.userFlag&&1==b.data.dealState&&setInterval(function(){k.getRefreshPrice(k.para.dealId)},1e4)}else c.isNotEmpty(b.tip)?c.lightToast(b.tip):c.lightToast("订单详情数据异常")},function(a){c.lightToast("网络异常，稍后重试")})},getIsBuyer:function(){return 1==k.para.userFlag?!0:!1},renderProductInfo:function(b){a(".ui-order-product").html(d.template(a(".product-info").text())(b))},renderProductSerials:function(b){a(".device-tip").html(k.para.imShowStr),a(".device-dialog-list").html(d.template(a(".device-list").text())(b))},renderAddrInfo:function(b){var c=b.receiveMobile,e=b.receiveName,f=b.receiveAddr;c.indexOf("****")>-1&&/^1(3|4|5|7|8)\d{9}$/.test(c)||(b.receiveMobile=k.decrypt(c,k.para.aesKey)||""),b.receiveName=k.decrypt(e,k.para.aesKey)||e,b.receiveAddr=k.decrypt(f,k.para.aesKey)||f,a(".ui-order-address1").html(d.template(a("#addrInfo").text())(b)).removeClass("ui-hide")},initData:function(){var b={url:c.getHost(1)+"/order/v1/refund/secGetDealRefundDetail",data:{dealId:k.para.dealId}};c.load(b).then(function(b){if(0==b.code)if(k.getIsBuyer())0!==k.para.refundid?(a(".ui-back-money").show(),a(".order-top ul").html('<li><img class="img-close" src="image/greenSeccess.png"></li>'),a(".order-top-tip").html("退款成功").css("padding-top","0").css("text-align","center").css("display","block").css("color","#FF3434"),a(".ui-back-money .ui-how-right").html("¥"+b.data.refundToBuyer),a(".order-top-tip2").hide()):(a(".order-top ul").html('<li><img class="img-close" src="image/img-colse.png"></li>'),a(".order-top-tip").html(k.para.dealStateDesc).css("padding-top","0").css("text-align","center").css("display","block"));else{var d=Number(b.data.payToSeller);0!==k.para.refundid&&d>0?(a(".order-top ul").html('<li><img class="img-close" src="image/greenSeccess.png"></li>'),a(".order-top-tip").html("收款成功").css("padding-top","0").css("text-align","center").css("display","block").css("color","#FF3434"),a(".order-top-tip2").hide(),a(".ui-back-money").show(),a(".ui-back-money .ui-how-left").html("收款金额"),a(".ui-style .ui-style-left").html("收款方式"),a(".ui-style .ui-style-right").html("京东钱包"),a(".ui-back-money .ui-how-right").html("¥"+d)):(a(".order-top ul").html('<li><img class="img-close" src="image/img-colse.png"></li>'),a(".order-top-tip").html(k.para.dealStateDesc).css("padding-top","0").css("text-align","center").css("display","block"),a(".order-top-tip2").hide())}else c.isNotEmpty(b.tip)?c.lightToast(b.tip):c.lightToast("信息异常~")},function(a){c.lightToast("网络出错，请稍后再试！")})},stateHandler:function(b){a(".order-btn-bottom ,.order-btn-bottom2").addClass("ui-hide");var c="",d="",e="",f="",g=b.length;switch(parseInt(g)){case 1:e=b[0].value,a(".order-btn-bottom2").data("reqtype",b[0].key).attr("clstag",k.setClsTag(b[0].key)),a(".order-btn-bottom2 span").html(e),a(".order-btn-bottom2").removeClass("ui-hide");break;case 2:c=b[0].value,d=b[1].value,a(".order-btn-bottom .order-bb-left").data("reqtype",b[0].key).attr("clstag",k.setClsTag(b[0].key)),a(".order-btn-bottom .order-bb-right").data("reqtype",b[1].key).attr("clstag",k.setClsTag(b[1].key)),a(".order-btn-bottom .order-bb-left span").html(c),a(".order-btn-bottom .order-bb-right span").html(d),a(".order-btn-bottom").removeClass("ui-hide");break;case 3:c=b[0].value,f=b[1].value,d=b[2].value,a(".order-btn-bottom3 .order-bb-left").data("reqtype",b[0].key).attr("clstag",k.setClsTag(b[0].key)),a(".order-btn-bottom3 .order-bb-center").data("reqtype",b[1].key).attr("clstag",k.setClsTag(b[1].key)),a(".order-btn-bottom3 .order-bb-right").data("reqtype",b[2].key).attr("clstag",k.setClsTag(b[2].key)),a(".order-btn-bottom3 .order-bb-left span").html(c),a(".order-btn-bottom3 .order-bb-center span").html(f),a(".order-btn-bottom3 .order-bb-right span").html(d),a(".order-btn-bottom3").removeClass("ui-hide")}},setClsTag:function(a){var b={cancel:"pageclick|keycount|order__201708091|1",pay:"pageclick|keycount|order__201708091|2",urge:"pageclick|keycount|order__201708091|6",alterPrice:"pageclick|keycount|order__201708091|3",remindReceive:"pageclick|keycount|order__201708091|12",refund:"pageclick|keycount|order__201708091|5",delivery:"pageclick|keycount|order__201708091|4",confirmDelivery:"pageclick|keycount|order__201708091|7",lookComment:"pageclick|keycount|order__201708091|10",comment:"pageclick|keycount|order__201708091|9",lookPay:"pageclick|keycount|order__201708091|8",lookRefund:"pageclick|keycount|order__201708091|11",lookPayQR:"pageclick|keycount|PaiPai_1530263627402|18",receiveMoney:"pageclick|keycount|PaiPai_1530263627402|19"};return b[a]||""},getPayInfo:function(){var b={url:c.getHost(1)+"/order/v1/deal/getPayDataByDealId",data:{dealId:k.para.dealId}},d={};c.isNotEmpty(commonPara)&&(d=a.extend(d,b.data,commonPara),b.data=d),c.load(b).then(function(a){a&&0==a.code?k.jumpJDPay(a.data,a.payUrl):c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("收银台数据异常")},function(a){c.lightToast("网络异常，稍后重试")})},getVerityAuthUser:function(){var a={url:c.getHost()+"/jdWallet/verityAuthUser"};c.load(a).then(function(a){if(a&&0==a.code)if(a.data&&1==a.data)k.queryCustomIdByJdPin();else{var b="/orderDetail.html?dealId="+k.para.dealId,d=c.getParameter("sid"),e="//msc.jd.com/auth/loginpage/wcoo/toAuthPage?source=2&businessType=424&sid="+d+"&directReturnUrl="+encodeURIComponent(b);c.goUrl(e)}else c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("用户实名校验异常")},function(a){c.lightToast("网络异常，稍后重试")})},queryCustomIdByJdPin:function(){var a={url:c.getHost()+"/jdWallet/queryCustomIdByJdPin"};c.load(a).then(function(a){if(a&&0==a.code)if(a.data&&c.isNotEmpty(a.data)&&a.data.length>0){var b="/orderDetail.html?dealId="+k.para.dealId;c.goUrl("/deliverGoods.html?dealId="+k.para.dealId+"&backUrl="+encodeURIComponent(b))}else{var b="orderDetail.html?dealId="+k.para.dealId;c.goUrl("/bindWallet.html?backUrl="+encodeURIComponent(b))}else c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("用户未绑定钱包")},function(a){c.lightToast("网络异常，稍后重试")})},jumpJDPay:function(b,d){c.isEmpty(d)&&(d="//test.h5pay.jd.com/jdpay/saveOrder");var e=a('<form method="post" action="'+d+'"></form>');Object.keys(b).forEach(function(a){c.log(a+"||"+b[a]),e.append('<input type="hidden" name="'+a+'" value="'+b[a]+'">')}),e.appendTo("body").submit()},cancelDeal:function(b,d,e){var f={url:c.getHost(1)+"/order/v1/deal/cancelDeal",data:{dealId:d,closeReasonDesc:b,closeReason:e,optSource:"3",machineKey:"test"}};c.load(f).then(function(b){b&&0==b.code?(c.lightToast("取消成功"),location.reload()):c.isNotEmpty(b.tip)?(c.lightToast(b.tip),a(".reverse-dialog").hide()):(c.lightToast("取消异常"),a(".reverse-dialog").hide())},function(a){c.lightToast("网络异常，稍后重试")})},cancelDeal4Refund:function(b,d,e){var f={url:c.getHost(1)+"/order/v1/deal/cancelDeal4Refund",data:{dealId:d,closeReasonDesc:b,closeReason:e,optSource:"3",machineKey:"test"}};c.load(f).then(function(b){if(c.log("取消订单"+JSON.stringify(b)),b&&0==b.code){c.lightToast("取消订单成功");var d=c.getParameter("backUrl");c.isNotEmpty(d)?c.goUrl(d):location.reload()}else c.log("取消订单异常"),a(".reverse-dialog").hide()},function(a){c.lightToast("网络异常，稍后重试")})},reminderDeal:function(){var b={url:c.getHost(1)+"/order/v1/deal/reminderDeal",data:{dealId:k.para.dealId}};c.load(b).then(function(b){b&&0==b.code?k.getIsBuyer()?(c.lightToast("已催促卖家发货，请耐心等待"),a(".reverse-dialog").hide()):(c.lightToast("已催促买家收货，请耐心等待 "),a(".reverse-dialog").hide()):c.isNotEmpty(b.tip)?(c.lightToast(b.tip),a(".reverse-dialog").hide()):(c.lightToast("催一下异常"),a(".reverse-dialog").hide())},function(a){c.lightToast("网络异常，稍后重试")})},confirmReceived:function(){var b={url:c.getHost(1)+"/order/v1/deal/confirmReceived",data:{dealId:k.para.dealId}};c.load(b).then(function(b){c.log("确认收货"+JSON.stringify(b)),b&&0==b.code?(c.lightToast("确认收货完成"),location.reload()):c.isNotEmpty(b.tip)?(c.lightToast(b.tip),a(".reverse-dialog").hide()):(c.lightToast("确认收货异常"),a(".reverse-dialog").hide())},function(a){c.lightToast("网络异常，稍后重试")})},priceFiler:function(a,b){var d=!0;return c.isEmpty(a)&&(c.lightToast("价格不能为空"),d=!1),1==this.para.dealType&&b>25&&(c.lightToast("最大运费金额不超过25元"),d=!1),d},alterDealPrice:function(){var b=a("#editPriceInput").val(),d=a("#editDeliveryPriceInput").val();if(k.priceFiler(b,d)){var e={url:c.getHost(1)+"/order/v1/deal/alterDealPrice",data:{dealId:k.para.dealId,commodityPrice:b,commodityShippingFee:d}};c.load(e).then(function(a){c.log("修改价格"+JSON.stringify(a)),a&&0==a.code?(c.lightToast(a.tip||"价格修改成功"),setTimeout(function(){location.reload()},1500)):c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("确认收货异常")},function(a){c.lightToast("网络异常，稍后重试")})}},topStateHandler:function(b,d){b&&(c.isNotEmpty(d)&&0!=d&&4==b||5==b||(11==b||6==b||7==b||8==b||9==b?(a(".order-top ul").html('<li><img class="img-close" src="image/tuikuan.png"></li>'),a(".order-top-tip").css("padding-top","0").css("text-align","center").css("display","block")):102==b||10==b?(a(".order-top-tip").css("display","block"),a(".order-top-tip2").hide(),a(".order-top ul").addClass("deal-state"+b)):a(".order-top ul").addClass("deal-state"+b)))},extendGoods:function(a){var b={url:c.getHost(1)+"/order/v1/deal/updateConfirmReceivedTime",type:"POST",data:{dealId:a}};c.load(b).then(function(a){a&&0==a.code?location.reload():c.isNotEmpty(a.tip)?c.lightToast(a.tip):c.lightToast("延迟收货异常")},function(a){c.lightToast("网络异常，稍后重试")})}};k.init(),window.onpageshow=function(a){a.persisted&&k.init()},commonBiz=k});