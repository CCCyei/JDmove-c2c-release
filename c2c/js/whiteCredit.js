!function(){function a(a){document.body.scrollTop=document.documentElement.scrollTop=a}function b(){return document.body.scrollTop||document.documentElement.scrollTop}var c=0;open.onclick=function(){c=b(),document.body.classList.add("dialog-open"),document.body.style.top=-c+"px",mask.style.display="block"},close.onclick=function(){mask.style.display="none",document.body.classList.remove("dialog-open"),a(c)}}(),require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={para:{isSwitchOn:0},bodyScollHandler:function(){a(".reverse-dialog").is(":visible")?a("body").addClass("dialog-open"):a("body").removeClass("dialog-open")},init:function(){var c=b.getUrlParam("uin");if(!c)return void b.lightToast("缺少参数");var e={url:b.getHost()+"/user/getUserCredit?uin="+c};b.load(e).then(function(c){if(0==c.code){d.bodyScollHandler();var e=c.data,f="",g=0;e.isOwn?(f=e.whiteScore||"",g=parseInt(e.bai_level,10)||0,a(".credit-bottom").show(),d.para.isSwitchOn=e.isSwitchOn,e.isSwitchOn&&a(".mui-switch").addClass("mui-active"),d.addClick()):(d.bodyScollHandler(),e.isSwitchOn?(f=e.whiteScore||"",g=parseInt(e.bai_level,10)||0):(f="",g=0)),a(window).resize(d.drawCredit({value:f,data:[{text:"一般",level:5},{text:"中等",level:4},{text:"良好",level:3},{text:"优秀",level:2},{text:"极好",level:1}],level:g}))}else b.lightToast(c.tip||"网络异常，稍后重试")},function(a){b.lightToast(result.tip||"网络异常，稍后重试")})},circleAnimation:function(b){var c=0,d=a(".credit-circle").children(".credit-circle-change"),e=setInterval(function(){var a=d.eq(c);a.siblings(".credit-circle-change-50bai").removeClass("credit-circle-change-50bai"),a.siblings(".credit-circle-change-bai").removeClass("credit-circle-change-bai").addClass("credit-circle-change-50bai"),a.addClass("credit-circle-change-bai"),c++,c>5-b&&(setTimeout(function(){a.siblings(".credit-circle-change-50bai").removeClass("credit-circle-change-50bai")},300),clearInterval(e))},300)},addClick:function(){a(".reverse-dialog #success").unbind("click").bind("click",function(){d.switchClick(),a(".reverse-dialog").hide(),d.bodyScollHandler()}),a(".reverse-dialog #cancel").unbind("click").bind("click",function(){a(".reverse-dialog").hide(),d.bodyScollHandler()}),a(".credit-bottom-right").unbind("click").bind("click",function(){a(".mui-switch").hasClass("mui-active")?(a(".mui-switch").removeClass("mui-active"),d.para.isSwitchOn=0,d.switchClick(),d.bodyScollHandler()):(d.para.isSwitchOn=1,a(".reverse-dialog iframe").length||a.get("./widget/whiteText.html",function(b){a(".reverse-dialog .reverse-dialog-iframe").html(b)}),a(".reverse-dialog").css("display","flex"),d.bodyScollHandler())})},switchClick:function(){var c={url:b.getHost()+"/user/updateSwitch",data:d.para};b.load(c).then(function(c){0==c.code?d.para.isSwitchOn?(a(".mui-switch").addClass("mui-active"),b.lightToast("已授权")):b.lightToast("未授权"):b.lightToast(c.tip||"网络异常，稍后重试")},function(a){b.lightToast(result.tip||"网络异常，稍后重试")})},drawCredit:function(b){function c(){g.beginPath();var a=g.createLinearGradient(i-j/2+180,k-j/2+180,i-j/2+180,k+j/2-180);a.addColorStop(0,"rgb(255, 255, 255)"),a.addColorStop(1,"rgb(255, 222, 222)"),g.fillStyle=a,g.shadowOffsetX=15,g.shadowOffsetY=15,g.shadowBlur=15,g.shadowColor="rgba(248, 24, 24, 0.5)",navigator.userAgent.match(/iphone os 10_2_1/i)&&(g.fillStyle="rgb(255, 242, 242)"),g.arc(i,k,j/2-180,0,2*Math.PI,!1),g.fill(),g.closePath()}function e(){g.beginPath(),g.shadowOffsetX=0,g.shadowOffsetY=0,g.shadowBlur=0,g.shadowColor="";var a=g.createLinearGradient(i-j/2+255,k-j/2+255,i-j/2+255,k+j/2-255);a.addColorStop(0,"rgb(255, 236, 236)"),a.addColorStop(1,"rgb(255, 255, 255)"),g.fillStyle=a,g.lineWidth=2,g.arc(i,k,j/2-255,0,2*Math.PI,!1),g.fill(),g.strokeStyle="rgb(255, 224, 224)",g.stroke(),g.font="96px Microsoft YaHei",g.fillStyle="rgb(252, 82, 71)",g.textAlign="center",g.textBaseline="middle",g.fillText(l,i,k),g.closePath()}var f=document.getElementById("canvas");f.style.width=window.innerWidth+"px",f.style.height="270px",f.width=3*window.innerWidth,f.height=810;for(var g=f.getContext("2d"),h=f.width,i=h/2,j=f.height,k=j/2+150,l=b.value.toFixed(1),m=b.data,n=b.level,o=function(a,b){return{x:i+a*Math.cos(b),y:k+a*Math.sin(b)}},p=.73*Math.PI,q=2.27*Math.PI,r=(m.length,[]),s=0;s<m.length;s++){var t=m[s];-1==r.join("").indexOf(t.min),r.push(t.text)}var u=r.length-1,v=(q-p)/u,w=(q-p-v)/u;c(),e();var x=p+v/2+w*(5-n),y=null,z=function(b){var c=.8*b*Math.PI,d=c>x?x:c,e=j/2-147,f=o(e,d),h=o(e-36,d-.2),i=o(e-36,d+.2);g.beginPath(),g.moveTo(f.x+1.5,f.y-1.5),g.lineTo(i.x+1.5,i.y-1.5),g.lineTo(h.x+1.5,h.y-1.5),g.closePath(),g.fillStyle="#fff",g.fill(),c>x&&(clearInterval(y),a(".credit-top-text span").eq(5-n).css("color","#fff"))};if(n&&6>n&&n>0){d.circleAnimation(n);var A=1;y=setInterval(function(){g.clearRect(0,0,3*f.width,810),A+=.012,c(),e(),z(A)},12)}}};d.init()});