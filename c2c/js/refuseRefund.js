require(["jquery","utils","dot","uploadShowLocalPic"],function(a,b,c){"use strict";var d="",e={obj:{dealId:0,sellerRefuseType:"",sellerRefundMsg:"",pic:"",machineKey:"test",optSource:3},init:function(){var a=b.getUrlParam("dealId");if(!a)return void b.lightToast("缺少参数");e.obj.dealId=a;var c={url:b.getHost(1)+"/order/v1/refund/secGetDealRefundDetail",data:{dealId:a}};b.load(c).then(function(a){var c=a.data;return 0!=a.code?void(b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("请求失败~")):26!=c.refundState&&32!=c.refundState?void b.lightToast("暂不能提交申请"):(d=parseInt(c.deliveryId,10)>0?{id:"select-reason",title:"拒绝原因",arr:[{name:"商品破损、缺件，影响二次销售",value:5},{name:"退回商品非所售出商品",value:6},{name:"其他",value:7}]}:{id:"select-reason",title:"拒绝原因",arr:[{name:"商品没问题，买家举证无效",value:1},{name:"商品没问题，买家未举证",value:2},{name:"商品已经影响二次销售",value:3},{name:"要求买家承担发货运费",value:4}]},void e.bindEvents())})},bindEvents:function(){b.selectFloat(d,function(b){var c=a(b).text(),d=a(b).attr("data-value");e.obj.sellerRefuseType!==d&&(a("#refund-reason .reverse-panel-right").html(c+'<img src="image/to-right.png" class="reverse-panel-right-arrow">'),e.obj.sellerRefuseType=d),a("#select-reason").hide()}),a("#refund-reason").bind("click",function(){a("#select-reason").show()}),b.changeLength(".reverse-remark-textarea",300,function(a){e.obj.sellerRefundMsg=a}),a("#refuse-refund").bind("click",function(){var a=e.obj;if(a.sellerRefuseType)if(a.sellerRefundMsg){var c=[];for(var d in imgObj){if(imgObj[d].length>0&&b.checkBase64(imgObj[d]))return void b.lightToast("存在未上传完的图片");c.push(imgObj[d])}e.obj.pic=c.toString();var f={url:b.getHost(1)+"/order/v1/refund/refuseRefund",data:e.obj};b.load(f).then(function(a){0==a.code?b.goUrl("/refundDetail.html?dealId="+e.obj.dealId):b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("提交异常~")},function(a){b.lightToast("网络异常，稍后重试")})}else b.lightToast("请选填写拒绝理由");else b.lightToast("请选择拒绝原因")})}};e.init()});