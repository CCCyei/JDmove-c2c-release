require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={init:function(){d.getRsaPublicKey(),d.getDefaultPara(),d.changePhone(),d.addClick(),d.listenInputChange(),d.listenSaveBtnStatu()},para:{rsaPublicKey:"",isPhoneChange:"",index:"",addressId:"",name:"",mobile:"",provinceId:0,cityId:0,countryId:0,townId:0,provinceName:"",cityName:"",countryName:"",townName:"",addressDetail:"",addressDefault:"",tempDefault:!0},addClick:function(){a(".btn-delete").unbind("click").bind("click",function(){d.getDeleteAddress(d.para.addressId)}),a(".btn-img").unbind("click").bind("click",function(){var c=b.getParameter("addInfo");b.isNotEmpty(c)&&(c=JSON.parse(c)),a(this).hide().siblings().show(),"none"==a(".ui-img1").css("display")?(d.para.index="",d.para.addressDefault=!1,d.para.tempDefault=!0):(d.para.index=0,d.para.addressDefault=!0,d.para.tempDefault=!1)}),a(".ui-area").unbind("click").bind("click",function(){d.addressInit()}),a(".ui-address .title div").unbind("click").on("click",function(){a(this).addClass("selected").siblings().removeClass("selected");var b=a(this).index();a(".list").addClass("hide").eq(b).removeClass("hide")}),a(".ui-address .province-list").delegate(".province-name","click",function(){var b=a(this).attr("value"),c=a(this).attr("name");a(".ui-address .province").html(a(this).text()),a(".ui-address .county").hide(),a(this).addClass("selected").removeClass("hide").siblings().removeClass("selected"),a(".province-list .font-item").hide(),a(this).find(".font-item").show(),d.getCityList(b),d.listenSaveBtnStatu(),d.para.provinceId=b,d.para.provinceName=c,d.para.cityId="",d.para.cityName="",d.para.countryId="",d.para.countryName="",d.para.townId="",d.para.townName=""}),a(".ui-address .city-list").delegate(".city-name","click",function(){var b=a(this).attr("value"),c=a(this).attr("name");a(".ui-address .city").html(a(this).text()),a(this).addClass("selected").siblings().removeClass("selected"),a(".city-list .font-item").hide(),a(this).find(".font-item").show(),d.getCountyList(b),d.listenSaveBtnStatu(),d.para.cityId=b,d.para.cityName=c,d.para.countryId="",d.para.countryName="",d.para.townId="",d.para.townName=""}),a(".ui-address .county-list").delegate(".county-name","click",function(){var b=a(this).attr("value"),c=a(this).attr("name");a(".ui-address  .county").html(a(this).text()),a(this).addClass("selected").siblings().removeClass("selected"),a(".county-list .font-item").hide(),a(this).find(".font-item").show(),d.getAreaList(b),d.listenSaveBtnStatu(),d.para.countryId=b,d.para.countryName=c,d.para.townId="",d.para.townName="",a(".ui-area-value").text(d.para.provinceName+d.para.cityName+d.para.countryName+d.para.townName)}),a(".ui-address .area-list").delegate(".area-name","click",function(){var b=a(this).attr("value"),c=a(this).attr("name");a(".ui-address  .area").html(a(this).text()),a(this).addClass("selected").siblings().removeClass("selected"),a(".area-list .font-item").hide(),a(this).find(".font-item").show(),d.para.townId=b,d.para.townName=c,a(".ui-area-value").text(d.para.provinceName+d.para.cityName+d.para.countryName+d.para.townName),a(".ui-address").addClass("hide")}),a(".bid-selected").unbind("click").on("click",function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}),a(".ui-address .close, .ui-address").unbind("click").on("click",function(){a(".ui-address").addClass("hide")})},getRsaPublicKey:function(){var a={url:b.getHost()+"/security/rsaPublicKey",data:{}};b.load(a).then(function(a){a&&0==a.code?d.para.rsaPublicKey=a.data:b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("加密key异常")},function(a){})},encrypt:function(a,b){var c=new JSEncrypt;c.setPublicKey(b);var d=c.encrypt(a);return d||(d=a),d},listenInputChange:function(){a("#username").bind("input propertychange",function(){d.para.name=a(this).val(),d.setCompareSameInfo()&&(d.para.tempDefault=!1),d.listenSaveBtnStatu()}),a("#tel").bind("input propertychange",function(){var b=a(this).val();d.para.mobile=d.encrypt(b,d.para.rsaPublicKey),d.setCompareSameInfo()&&(d.para.tempDefault=!1),d.listenSaveBtnStatu()}),a(".address-value").bind("input propertychange",function(){d.para.addressDetail=a(this).val(),a(".address-value").val().trim().length>=50?b.lightToast("详细地址最多支持50个字"):d.listenSaveBtnStatu(),d.setCompareSameInfo()&&(d.para.tempDefault=!1)})},listenSaveBtnStatu:function(){return a("#tel").val().length>0&&a("#username").val().length>0&&a(".address-value").val().length>0&&a(".ui-area-value").text().length>0?(a(".btn-save").removeClass("disable"),void d.saveBtnClick()):(a(".btn-save").addClass("disable"),!1)},saveBtnClick:function(){a(".btn-save").unbind("click").bind("click",function(){a(".btn-save").hasClass("disable")||(d.para.isPhoneChange?d.checkPhone()?d.setSaveAddInfo():b.lightToast("您的手机号码未输入或输入错误!"):d.setSaveAddInfo())})},setCompareSameInfo:function(){return a("#tel").val().trim()!=a("#tel").attr("usertel")||a("#username").val().trim()!=a("#username").attr("username")||a(".ui-area-value").text().trim()!=a(".ui-area-value").attr("areaname")||a(".address-value").val().trim()!=a(".address-value").attr("useraddress")?!0:!1},getDefaultPara:function(){var a=b.getParameter("addInfo");b.isNotEmpty(a)&&(a=JSON.parse(a),this.para.addressId=a.addressId,this.para.name=a.name,this.para.mobile=a.mobile,this.para.provinceId=a.provinceid,this.para.cityId=a.cityid,this.para.countryId=a.countryid,this.para.areaId=a.areaid,this.para.townId=a.townid,this.para.addressDetail=a.addressDetail,this.para.addressDefault=a.addressDefault,d.setInfoPara(),d.setDefaultArea())},setInfoPara:function(){a(".ui-area .ui-area-value").removeClass("ui-area-value-grey"),a("#username").val(d.para.name),a("#username").attr("username",d.para.name),a("#tel").val(d.para.mobile),a("#tel").attr("usertel",d.para.mobile),a(".address-value").val(d.para.addressDetail),a(".address-value").attr("useraddress",d.para.addressDetail),"true"==d.para.addressDefault?(a(".btn-img").hide(),a(".btn-img.ui-img1").show(),d.para.index=0):(a(".btn-img").show(),a(".btn-img.ui-img1").hide(),d.para.index="")},setDefaultArea:function(c){b.isNotEmpty(c)?a(".ui-address").removeClass("hide"):(d.getProvinceList(),a(".ui-address .province").html(a(".ui-address .province-name[value="+d.para.provinceId+"]").text()),a(".ui-address .province-name[value="+d.para.provinceId+"]").addClass("selected").removeClass("hide").siblings().removeClass("selected"),setTimeout(function(){d.getCityList(d.para.provinceId),a(".ui-address .city").html(a(".ui-address .city-name[value="+d.para.cityId+"]").text()),a(".ui-address .city-name[value="+d.para.cityId+"]").addClass("selected").siblings().removeClass("selected")},50),setTimeout(function(){d.getCountyList(d.para.cityId),a(".ui-address .county").html(a(".ui-address .county-name[value="+d.para.countryId+"]").text()),a(".ui-address .county-name[value="+d.para.countryId+"]").addClass("selected").siblings().removeClass("selected")},100))},checkPhone:function(){var b=a("#tel").val();return/^1(3|4|5|7|8)\d{9}$/.test(b)?!0:void 0},changePhone:function(){a("#tel").unbind("change").bind("change",function(){d.para.isPhoneChange=!0})},arrSplitRsa:function(a){for(var b="",c=a.length,e=Math.ceil(c/35),f=0;e>f;f++){var g=a.slice(35*f,35*(f+1));b+=d.encrypt(g,d.para.rsaPublicKey)+"-_-"}return b=b.slice(0,b.length-3)},setSaveAddInfo:function(){var c=d.arrSplitRsa(d.para.addressDetail),e=d.arrSplitRsa(d.para.provinceName+d.para.cityName+d.para.countryName+d.para.townName+d.para.addressDetail),f={url:b.getHost()+"/receiveAddr/secUpdateReceiveAddr",data:{id:d.para.addressId,provinceId:d.para.provinceId,phone:d.para.mobile,cityId:d.para.cityId,townName:d.para.townName,cityName:d.para.cityName,provinceName:d.para.provinceName,addressDetail:c,countyName:d.para.countryName,name:d.encrypt(d.para.name,d.para.rsaPublicKey),countyId:d.para.countryId,addressName:"",fullAddress:e,postCode:"",townId:d.para.townId,addressType:1,addressDefault:d.para.addressDefault,mobile:d.para.mobile},type:"POST"};b.load(f).then(function(c){if("0"==c.code){b.lightToast("编辑成功!"),d.para.addressDefault&&(d.para.tempDefault=!0),a("#tel").attr("usertel",a("#tel").val()),a("#username").attr("username",a("#username").val()),a(".ui-area-value").attr("areaname",a(".ui-area-value").text()),a(".address-value").attr("useraddress",a(".address-value").val());var e=b.getParameter("mgUrl"),f=b.getParameter("backUrl");b.isNotEmpty(e)?setTimeout(function(){location.replace(decodeURIComponent(e)+"?index="+d.para.index+"&backUrl="+decodeURIComponent(f))},1e3):b.goUrl("/c2c/addrManger.html?idex="+d.para.index)}else b.isNotEmpty(c.tip)&&b.lightToast(c.tip)},function(a){b.lightToast("编辑失败!")})},getDeleteAddress:function(a){var c={url:b.getHost()+"/receiveAddr/deleteReceiveAddr",data:{addressId:a}};b.load(c).then(function(a){if("0"==a.code){b.lightToast("删除成功!");var c=b.getParameter("backUrl");b.isNotEmpty(c)?setTimeout(function(){var a=b.getParameter("mgUrl"),c=b.getParameter("backUrl");b.isNotEmpty(a)?setTimeout(function(){location.replace(decodeURIComponent(a)+"?backUrl="+decodeURIComponent(c))},1e3):b.goUrl("/c2c/addrManger.html")},1e3):b.goUrl("/c2c/addrManger.html")}else b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("删除失败!")},function(a){b.lightToast("删除失败!")})},getProvinceList:function(){var e={url:b.getHost()+"/area/getProvinceList",data:{isHidden:1}};b.load(e).then(function(e){if(e.data&&e.data.length>0){var f,g;f=a(".province-list"),g="province-name";var h=a("#address").html().replace("typename",g),i=c.template(h),j=i(e.data);f.html(j),d.addressViewHandler(1),b.isNotEmpty(d.para.provinceId)?(a(".ui-address .province-name[value="+d.para.provinceId+"]").find(".font-item").show(),a(".ui-address .province-name[value="+d.para.provinceId+"]").addClass("selected").siblings().removeClass("selected"),d.para.provinceName=a(".ui-address .province-name[value="+d.para.provinceId+"]").text().trim(),a(".ui-address .province").show().html(a(".ui-address .province-name[value="+d.para.provinceId+"]").text()).addClass("selected").siblings().removeClass("selected")):(a(".ui-address .province-name").find(".font-item").hide(),a(".ui-address .province").show().html("请选择").addClass("selected").siblings().removeClass("selected")),a(".new .title div").each(function(b){b>1&&a(this).hide()}),a(".list").each(function(b){b>1&&a(this).find("div").removeClass("selected")})}else a(".ui-area-value").text(d.para.provinceName),d.para.cityId=0,d.para.countryId=0,d.para.townId=0,d.para.cityName="",d.para.countryName="",d.para.townName="",a(".ui-address").addClass("hide")})},getCityList:function(e){var f={url:b.getHost()+"/area/getCityListByProvinceId",data:{provinceId:e}};b.load(f).then(function(e){if(e.data&&e.data.length>0){var f,g;f=a(".city-list"),g="city-name";var h=a("#address").html().replace("typename",g),i=c.template(h),j=i(e.data);f.html(j),d.addressViewHandler(2),b.isNotEmpty(d.para.cityId)?(a(".ui-address .city-name[value="+d.para.cityId+"]").find(".font-item").show(),a(".ui-address .city-name[value="+d.para.cityId+"]").addClass("selected").siblings().removeClass("selected"),d.para.cityName=a(".ui-address .city-name[value="+d.para.cityId+"]").text().trim(),a(".ui-address .city").show().html(a(".ui-address .city-name[value="+d.para.cityId+"]").text()).addClass("selected").siblings().removeClass("selected")):(a(".ui-address .city-name").find(".font-item").hide(),a(".ui-address .city").show().html("请选择").addClass("selected").siblings().removeClass("selected")),a(".new .title div").each(function(b){b>2&&a(this).hide()}),a(".list").each(function(b){b>2&&a(this).find("div").removeClass("selected")})}else a(".ui-area-value").text(d.para.provinceName+d.para.cityName),d.para.countryId=0,d.para.townId=0,d.para.countryName="",d.para.townName="",a(".ui-address").addClass("hide")},function(a){console.log(a)})},getCountyList:function(e){var f={url:b.getHost()+"/area/getCountyListByCityId",data:{cityId:e}};b.load(f).then(function(e){if(e.data&&e.data.length>0){var f,g;f=a(".county-list"),g="county-name";var h=a("#address").html().replace("typename",g),i=c.template(h),j=i(e.data);f.html(j),d.addressViewHandler(3),b.isNotEmpty(d.para.countryId)?(a(".ui-address .county-name[value="+d.para.countryId+"]").find(".font-item").show(),a(".ui-address .county-name[value="+d.para.countryId+"]").addClass("selected").siblings().removeClass("selected"),d.para.countryName=a(".ui-address .county-name[value="+d.para.countryId+"]").text().trim(),a(".ui-address .county").show().html(a(".ui-address .county-name[value="+d.para.countryId+"]").text()).addClass("selected").siblings().removeClass("selected"),a(".ui-area-value").text(d.para.provinceName+d.para.cityName+d.para.countryName+d.para.townName),a(".ui-area-value").attr("areaname",a(".ui-area-value").text())):(a(".ui-address .county-name").find(".font-item").hide(),a(".ui-address .county").show().html("请选择").addClass("selected").siblings().removeClass("selected")),d.listenSaveBtnStatu(),a(".new .title div").each(function(b){b>3&&a(this).hide()}),a(".list").each(function(b){b>3&&a(this).find("div").removeClass("selected")})}else a(".ui-area-value").text(d.para.provinceName+d.para.cityName+d.para.countryName),d.para.townId=0,d.para.townName="",a(".ui-address").addClass("hide")})},getAreaList:function(e){var f={url:b.getHost()+"/area/getTownListByCountyId",data:{countyId:e}};b.load(f).then(function(e){if(e.data&&e.data.length>0){var f,g;f=a(".area-list"),g="area-name";var h=a("#address").html().replace("typename",g),i=c.template(h),j=i(e.data);f.html(j),d.addressViewHandler(4),b.isNotEmpty(d.para.townId)?(a(".ui-address .area-name[value="+d.para.townId+"]").find(".font-item").show(),a(".ui-address .area-name[value="+d.para.townId+"]").addClass("selected").siblings().removeClass("selected"),d.para.townName=a(".ui-address .area-name[value="+d.para.townId+"]").text().trim(),a(".ui-address .province").show().html(a(".ui-address .province-name[value="+d.para.townId+"]").text()).addClass("selected").siblings().removeClass("selected")):(a(".ui-address .area-name").find(".font-item").hide(),a(".ui-address .area").show().html("请选择").addClass("selected").siblings().removeClass("selected")),a(".new .title div").each(function(b){b>4&&a(this).hide()}),a(".list").each(function(b){b>4&&a(this).find("div").removeClass("selected")})}else a(".ui-address").addClass("hide")})},addressViewHandler:function(b){var c=a(".ui-address .province-list"),d=a(".ui-address .city-list"),e=a(".ui-address .county-list"),f=a(".ui-address .area-list");switch(b){case 1:c.removeClass("hide"),d.addClass("hide"),e.addClass("hide"),f.addClass("hide");break;case 2:c.addClass("hide"),d.removeClass("hide"),e.addClass("hide"),f.addClass("hide");break;case 3:c.addClass("hide"),d.addClass("hide"),e.removeClass("hide"),f.addClass("hide");break;case 4:c.addClass("hide"),d.addClass("hide"),e.addClass("hide"),f.removeClass("hide");break;default:c.addClass("hide"),d.addClass("hide"),e.addClass("hide"),a(".ui-address").removeClass("hide")}},addressInit:function(){b.isNotEmpty(d.para.provinceId)?d.setDefaultArea("show"):(a(".ui-address .title div").html("请选择"),a(".ui-address .title div").addClass("selected").show().siblings().removeClass("selected").hide(),a(".ui-address .province").hide(),a(".ui-address .list").removeClass("selected"),d.getProvinceList(),a(".ui-address").removeClass("hide"),d.addressViewHandler(1))}};d.init()});