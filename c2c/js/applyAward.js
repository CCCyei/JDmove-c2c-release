require(["jquery","utils","dot","uploadShowLocalPic"],function(a,b,c){"use strict";var d={id:"select-reason",arr:[{name:"收到商品描述不符",value:1},{name:"商品质量问题",value:2},{name:"收到商品少件/破损/污渍等",value:3},{name:"数码商品屏幕问题",value:4},{name:"尺寸容量与商品描述不符",value:5},{name:"卖家发错货",value:6},{name:"其他",value:7},{name:"未按照约定时间发货",value:8},{name:"快递一直未送到",value:9},{name:"空包裹/少货",value:10},{name:"快递无跟踪记录",value:11},{name:"卖家未发货",value:12},{name:"订单信息有误",value:13},{name:"与卖家协商一致",value:14}]},e={id:"select-state",arr:[{name:"已收到货",value:1},{name:"未收到货",value:0}]},f={id:"select-award",arr:[{name:"商品没问题，买家执意退货",value:15},{name:"买家恶意延迟确认收货",value:16},{name:"收货运费无法达成一致",value:17},{name:"其他",value:7}]},g={obj:{dealId:0,receiveStatus:"",arbitramentType:"",arbitramentMoney:0,reason:"",pic:""},localObj:{},init:function(){var c=b.getUrlParam("dealId");if(!c)return void b.lightToast("缺少参数");g.obj.dealId=c;var e={url:b.getHost(1)+"/order/v1/refund/secGetDealRefundDetail",data:{dealId:c}};b.load(e).then(function(c){var e=c.data;if(g.bindEvents(),g.obj.arbitramentType=e.refundReasonType,g.obj.arbitramentMoney=e.dealPayFeeTotal,1==e.userFlag){for(var f=0;f<d.arr.length;f++){var h=d.arr[f];h.value==e.refundReasonType&&a("#refund-reason .reverse-panel-right").html(h.name)}a("#refund-reason").show()}else a("#award-reason").show();if(1==e.dealType&&b.isNotEmpty(e.pcoin)){g.hasPaibi=!0;var i="<img src='image/paibiBig.png' class='paibi-img' />  "+e.pcoin;a("#refund-pcoin .reverse-panel-right").html(i),a("#refund-pcoin").removeClass("hide")}else a(".ui-warning").addClass("ui-hide")},function(a){b.lightToast("网络出错，请稍后再试！")})},bindEvents:function(){b.changeLength(".reverse-remark-textarea",300,function(a){g.obj.reason=a}),b.selectFloat(e,function(b){var c=a(b).text(),d=a(b).attr("data-value");g.obj.receiveStatus!==d&&(a("#goods-state .reverse-panel-right").html(c+'<img src="image/to-right.png" class="reverse-panel-right-arrow">'),g.obj.receiveStatus=d),a("#select-state").hide()}),a("#goods-state").bind("click",function(){a("#select-state").show()}),b.selectFloat(f,function(b){var c=a(b).text(),d=a(b).attr("data-value");g.obj.arbitramentType!==d&&(a("#award-reason .reverse-panel-right").html(c+'<img src="image/to-right.png" class="reverse-panel-right-arrow">'),g.obj.arbitramentType=d),a("#select-award").hide()}),a("#award-reason").bind("click",function(){a("#select-award").show()}),a("#apply-award").bind("click",function(){var a=g.obj;if(a.receiveStatus)if(a.arbitramentType){var c=[];for(var d in imgObj){if(imgObj[d].length>0&&b.checkBase64(imgObj[d]))return void b.lightToast("存在未上传完的图片");c.push(imgObj[d])}g.obj.pic=c.toString();var e={url:b.getHost(1)+"/order/v1/arbitrament/createArbitrament",data:g.obj};b.load(e).then(function(c){"0"===c.code?b.goUrl("/refundDetail.html?dealId="+a.dealId):b.isNotEmpty(c.tip)&&b.lightToast(c.tip)},function(a){})}else b.lightToast("请选择仲裁原因");else b.lightToast("请选择货物状态")})}};g.init()});