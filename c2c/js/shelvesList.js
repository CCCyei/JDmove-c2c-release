!function(){function a(a){document.body.scrollTop=document.documentElement.scrollTop=a}function b(){return document.body.scrollTop||document.documentElement.scrollTop}var c=0;open.onclick=function(){c=b(),document.body.classList.add("dialog-open"),document.body.style.top=-c+"px",mask.style.display="block"},close.onclick=function(){mask.style.display="none",document.body.classList.remove("dialog-open"),a(c)}}(),require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={commodityId:"",page:""},e={page:1,pageSize:20,isLoading:!1,isAllLoad:!1,init:function(){e.getBuyList(e.page,e.pageSize),e.addScorll(),"jd"==b.getAppType()&&("Android"==b.getLoginTypeForJD()?a(".ui-down").show():"IOS"==b.getLoginTypeForJD()&&a(".ui-down").hide(),e.loadOrOpenApp())},loadOrOpenApp:function(){function b(){var a=Date.now(),b=document.createElement("iframe");b.src=c.indexOf("os")>0?d.state().scheme_IOS:d.state().scheme_Adr,b.style.display="none",document.body.appendChild(b);var e=setTimeout(function(){var b=Date.now();(!a||b-a<d.timeout+200)&&(window.location=(c.indexOf("os")>0,"appDown.html"))},d.timeout);window.onblur=function(){clearTimeout(e)},document.addEventListener("visibilitychange",function(){clearTimeout(e)})}var c=navigator.userAgent.toLowerCase(),d={state:function(){return{scheme_IOS:"openapp.paipai://pushToHome/app",scheme_Adr:"openapp.paipai://pushToHome/app"}},timeout:1e3};a("#ui-btn").unbind("click").bind("click",b)},bodyScollHandler:function(){a(".reverse-dialog-del").is(":visible")||a(".reverse-dialog").is(":visible")?a("body").addClass("dialog-open"):a("body").removeClass("dialog-open")},addClick:function(){"jd"==b.getAppType()?(a(".ui-del").unbind("click").bind("click",function(){b.lightToast("请打开拍拍")}),a(".goodsup").unbind("click").bind("click",function(){b.lightToast("请打开拍拍")}),a(".ui-close").click(function(){a(this).parents(".ui-open").hide(),a(this).parents(".ui-down").hide()})):(3==b.getType()?a(".goods").unbind("click").bind("click",function(){d.commodityId=a(this).attr("commodityId"),b.goUrl("/goodsDetail.html?ism=yes&itemid="+d.commodityId)}):a(".goods").unbind("click").bind("click",function(){d.commodityId=a(this).attr("commodityId"),location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+d.commodityId+"}"}),a(".ui-del").unbind("click").bind("click",function(){d.commodityId=a(this).parents(".ui-adress-edit").attr("commodityId"),a(".reverse-dialog-del").show(),e.bodyScollHandler()}),a(".reverse-dialog-del #success").unbind("click").bind("click",function(){e.getdelgoods(d.commodityId),a(".reverse-dialog-del").hide(),e.bodyScollHandler()}),a(".reverse-dialog-del #cancel").unbind("click").bind("click",function(){a(".reverse-dialog-del").hide(),e.bodyScollHandler()}),a(".goodsup").unbind("click").bind("click",function(){d.commodityId=a(this).parents(".ui-adress-edit").attr("commodityId"),a(".reverse-dialog").show(),e.bodyScollHandler()}),a(".reverse-dialog #success").unbind("click").bind("click",function(){e.getgoodsUp(d.commodityId),a(".reverse-dialog").hide(),e.bodyScollHandler()}),a(".reverse-dialog #cancel").click(function(){a(".reverse-dialog").hide(),e.bodyScollHandler()}))},getgoodsUp:function(c){var d={url:b.getHost()+"/commodity/v1/shelvesItem",data:{commodityId:c}};b.load(d).then(function(d){b.log("获取重新上架商品"+JSON.stringify(d)),console.log(d),d&&0==d.code?(a("div[commodityId="+c+"]").parents(".cart-goods-group").remove(),3==b.getType()||(location.href="openapp.paipai://backToApp")):d&&778==d.code?(a(".reverse-dialog").hide(),a(".reverse-dialog-name").show(),a(".reverse-dialog-name #success").unbind("click").bind("click",function(){location.href="//"+d.data+"m.paipai.com/shelvesList.html"}),a(".reverse-dialog-name #cancel").click(function(){a(".reverse-dialog-name").hide()})):b.isNotEmpty(d.tip)?b.lightToast(d.tip):b.lightToast("获取重新上架商品异常")},function(a){})},getdelgoods:function(c){var d={url:b.getHost()+"/commodity/v1/deleteItem",data:{commodityId:c}};b.load(d).then(function(d){b.log("删除商品"+JSON.stringify(d)),d&&0==d.code?(a("div[commodityId="+c+"]").parents(".cart-goods-group").remove(),3==b.getType()||(location.href="openapp.paipai://backToApp")):b.isNotEmpty(d.tip)?b.lightToast(d.tip):b.lightToast("删除商品异常")},function(a){})},addScorll:function(){a(window).on("scroll",function(){var b=a(window).scrollTop(),c=a(window).height(),d=document.body.scrollHeight;!e.isLoading&&!e.isAllLoad&&b+c+300>d&&(e.page+=1,e.isLoading=!0,e.getBuyList(e.page,e.pageSize))})},getBuyList:function(c,f){var g={url:b.getHost()+"/commodity/v1/getOffShelfItemList",data:{pageIndex:c,pageSize:f,orderField:"2_2"}};b.load(g).then(function(c){b.log("获取我下架列表"+JSON.stringify(c)),c&&0==c.code?c.data.commodityList&&c.data.commodityList.length>0?(e.renderBuyListInfo(c.data.commodityList),d.page=Math.ceil(c.data.totalCount/20),e.isLoading=!1,(!c.data.commodityList||c.data.commodityList.length<e.pageSize)&&(e.isAllLoad=!0)):1==e.page?(a(".bgview").removeClass("hide"),a(".bgview p").text("没有下架商品~"),a(".bgview img").attr("src","image/noShevlist.png")):b.lightToast("没有更多了"):b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("获取我下架列表异常")},function(a){})},renderBuyListInfo:function(b){b=b||[],a(".ui-goods-box ").append(c.template(a(".renderBuyListInfo").text())(b)),e.addClick()}};e.init()});