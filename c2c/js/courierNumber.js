require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={init:function(){d.initPara(function(){d.addClick(),d.listenSaveBtnStatu(),d.listenInputChange()})},para:{dealId:""},initPara:function(a){var c=b.getParameter("dealId");b.isNotEmpty(c)&&(d.para.dealId=c),a()},addClick:function(){a(".ui-address-phone").unbind("click").bind("click",function(){d.addressInit()}),a(".bid-selected").unbind("click").on("click",function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}),a(".ui-address .close, .ui-address").unbind("click").on("click",function(){a(".ui-address").addClass("hide")}),a(".ui-address .province-list").delegate(".province-name","click",function(){var b=a(this).attr("value"),c=a(this).attr("name");a(".ui-address .province").html(a(this).text()),a(this).addClass("selected").removeClass("hide").siblings().removeClass("selected"),a(".province-list .font-item").hide(),a(this).find(".font-item").show(),a("#delivery").attr("value",b),a("#delivery").attr("name",c),a("#delivery").val(c),a(".ui-address").addClass("hide"),d.listenSaveBtnStatu()}),a(".ui-area .ui-area-value img").unbind("click").bind("click",function(){location.href="openapp.paipai://scanQRCode/app?param=%7b%22methodName%22%3a%22scanQRCodeCallBack%22%7d"})},listenInputChange:function(){a("#deliveryCode").bind("input propertychange",function(){d.listenSaveBtnStatu()})},listenSaveBtnStatu:function(){return a("#delivery").val().length>0&&a("#deliveryCode").val().length>0?(a(".ui-layer-ft").removeClass("disable"),void d.saveBtnClick()):(a(".ui-layer-ft").addClass("disable"),!1)},saveBtnClick:function(){a(".ui-layer-ft").unbind("click").bind("click",function(){if(!a(".btn-save").hasClass("disable")){b.isNotEmpty(b.getParameter("userFlag"))?d.buyerConfirmDelivery():d.sellerConfirmDelivery()}})},addressInit:function(){b.isNotEmpty(a("#delivery").val())?a(".ui-address").removeClass("hide"):(a(".ui-address .title div").html("请选择"),a(".ui-address .title div").addClass("selected").show().siblings().removeClass("selected").hide(),a(".ui-address .province").hide(),a(".ui-address .list").removeClass("selected"),d.getDeliveryList(),a(".ui-address").removeClass("hide"))},getDeliveryList:function(){var d={url:b.getHost(1)+"/logistics/queryLogistics",data:{}};b.load(d).then(function(d){if(d.data&&d.data.length>0&&d.data[0].logisticsCode){var e,f;e=a(".province-list"),f="province-name";var g=a("#deliveryList").html().replace("typename",f),h=c.template(g),i=h(d.data);e.html(i),a(".ui-address .province-name").find(".font-item").hide(),a(".ui-address .province").show().html("请选择").addClass("selected").siblings().removeClass("selected"),a(".new .title div").each(function(b){b>1&&a(this).hide()}),a(".list").each(function(b){b>1&&a(this).find("div").removeClass("selected")})}else b.isNotEmpty(d.tip)&&(b.lightToast(d.tip),a(".ui-address").addClass("hide"))})},sellerConfirmDelivery:function(){var c=a("#delivery").attr("name"),e=a("#delivery").attr("value"),f=a("#deliveryCode").val();if(b.isEmpty(c)||b.isEmpty(e))b.lightToast("请选择物流公司");else if(b.isEmpty(f))b.lightToast("请填写物流单号");else{var g={url:b.getHost(1)+"/order/v1/deal/confirmDelivery",data:{dealId:d.para.dealId,deliveryType:"1",deliveryCompanyId:e,deliveryCompany:c,deliveryCode:f}};b.load(g).then(function(a){if(a&&0==a.code){b.lightToast("发货成功");var c=b.getParameter("backUrl");b.isNotEmpty(c)?b.goUrl(c):location.reload()}else b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("确认发货异常")},function(a){b.lightToast("网络异常，稍后重试")})}},buyerConfirmDelivery:function(){var c=a("#delivery").attr("name"),e=a("#delivery").attr("value"),f=a("#deliveryCode").val();if(b.isEmpty(c)||b.isEmpty(e))b.lightToast("请选择物流公司");else if(b.isEmpty(f))b.lightToast("请填写物流单号");else{var g={url:b.getHost(1)+"/order/v1/refund/confirmDelivery",data:{dealId:d.para.dealId,deliveryType:"1",deliveryCompanyId:e,deliveryCompany:c,deliveryCode:f,optSource:3}};b.load(g).then(function(a){if(a&&0==a.code){b.lightToast("发货成功");var c="?dealId="+d.para.dealId;b.goUrl("/refundDetail.html"+c)}else b.isNotEmpty(a.tip)?b.lightToast(a.tip):b.lightToast("确认发货异常")},function(a){b.lightToast("网络异常，稍后重试")})}}};window.scanQRCodeCallBack=function(b){a("#deliveryCode").val(b),d.listenSaveBtnStatu()},d.init()});