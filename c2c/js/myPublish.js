!function(){function a(a){document.body.scrollTop=document.documentElement.scrollTop=a}function b(){return document.body.scrollTop||document.documentElement.scrollTop}var c=0;open.onclick=function(){c=b(),document.body.classList.add("dialog-open"),document.body.style.top=-c+"px",mask.style.display="block"},close.onclick=function(){mask.style.display="none",document.body.classList.remove("dialog-open"),a(c)}}(),require(["jquery","utils","dot"],function(a,b,c){"use strict";var d={commodityId:"",refReason:"",page:""},e={page:1,pageSize:20,isLoading:!1,isAllLoad:!1,init:function(){e.getBuyList(e.page,e.pageSize),e.addScorll(),"jd"==b.getAppType()&&("Android"==b.getLoginTypeForJD()?a(".ui-down").show():"IOS"==b.getLoginTypeForJD()&&a(".ui-down").hide(),e.loadOrOpenApp()),a(".ui-header-back").click(function(){location.href=history.back()}),document.addEventListener("scroll",function(){document.body.scrollTop>=0?(a(".ui-tittle-box").removeClass("ui-hide"),a(".ui-tittle-flex").addClass("ui-tittle-flex-fixed")):(a(".ui-tittle-flex").removeClass("ui-tittle-flex-fixed"),a(".ui-tittle-box").addClass("ui-hide"))},!1),e.addClick()},bodyScollHandler:function(){a(".reverse-dialog-fail").is(":visible")||a(".reverse-dialog").is(":visible")?a("body").addClass("dialog-open"):a("body").removeClass("dialog-open")},loadOrOpenApp:function(){function b(){var a=Date.now(),b=document.createElement("iframe");b.src=c.indexOf("os")>0?d.state().scheme_IOS:d.state().scheme_Adr,b.style.display="none",document.body.appendChild(b);var e=setTimeout(function(){var b=Date.now();(!a||b-a<d.timeout+200)&&(window.location=(c.indexOf("os")>0,"appDown.html"))},d.timeout);window.onblur=function(){clearTimeout(e)},document.addEventListener("visibilitychange",function(){clearTimeout(e)})}var c=navigator.userAgent.toLowerCase(),d={state:function(){return{scheme_IOS:"openapp.paipai://pushToHome/app",scheme_Adr:"openapp.paipai://pushToHome/app"}},timeout:1e3};a("#ui-btn").unbind("click").bind("click",b)},addClick:function(){"jd"==b.getAppType()?(a(".ui-tittle").unbind("click").bind("click",function(){b.lightToast("请打开拍拍")}),a(".ui-del").unbind("click").bind("click",function(){b.lightToast("请打开拍拍")}),a(".goodsdown").unbind("click").bind("click",function(){b.lightToast("请打开拍拍")}),a(".ui-close").click(function(){a(this).parents(".ui-open").hide(),a(this).parents(".ui-down").hide()})):(a(".ui-tittle").click(function(){var a="/shelvesList.html";b.goUrl(a)}),a(".goods").click(function(){if(d.commodityId=a(this).attr("commodityId"),3==b.getType()){var c="/goodsDetail.html?ism=yes&itemid="+d.commodityId;b.goUrl(c)}else location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+d.commodityId+"}"}),a(".ui-del").click(function(){var c=a(this).parents(".ui-adress-edit");if(d.commodityId=c.attr("commodityId"),3==b.getType()){var e="/m/publish?itemId="+d.commodityId;b.goUrl(e)}else location.href='openapp.paipai://goodsEdit/app?param={"key1":'+d.commodityId+"}"}),a(".goodsdown").unbind("click").bind("click",function(){d.commodityId=a(this).parents(".ui-adress-edit").attr("commodityId"),a(".reverse-dialog").show(),e.bodyScollHandler()}),a(".ui-concat").unbind("click").bind("click",function(){if(d.refReason=a(this).parents(".ui-adress-edit").attr("refReason").replace(/\\r\\n/g,"<br>")||"",d.refReason&&"undefined"!==d.refReason){a(".reverse-dialog-fail").show(),a(".reverse-dialog-fail .reverse-dialog-panel-info").html(d.refReason),e.bodyScollHandler();var b=document.getElementById("txt-box"),c=(document.documentElement.clientHeight-b.offsetHeight)/2;a("#txt-box").css("margin-top",c+"px")}}),a(".ui-call").unbind("click").bind("click",function(){if(d.refReason=a(this).parents(".ui-adress-edit").attr("refReason")||"",d.refReason&&"undefined"!==d.refReason){a(".reverse-dialog-fail").show(),a(".reverse-dialog-fail .reverse-dialog-panel-info").html(d.refReason),e.bodyScollHandler();var b=document.getElementById("txt-box"),c=(document.documentElement.clientHeight-b.offsetHeight)/2;a("#txt-box").css("margin-top",c+"px")}}),a(".reverse-dialog-fail #success").unbind("click").bind("click",function(){a(".reverse-dialog-fail").hide(),e.bodyScollHandler()}),a(".reverse-dialog #success").unbind("click").bind("click",function(){e.getgoodsDown(d.commodityId),a(".reverse-dialog").hide(),e.bodyScollHandler()}),a(".reverse-dialog #cancel").click(function(){a(".reverse-dialog").hide(),e.bodyScollHandler()}))},getgoodsDown:function(c){var d={url:b.getHost()+"/commodity/v1/offshelveItem",data:{commodityId:c}};b.load(d).then(function(d){b.log("获取下架商品"+JSON.stringify(d)),d&&0==d.code?a("div[commodityId="+c+"]").parents(".cart-goods-group").remove():b.isNotEmpty(d.tip)?b.lightToast(d.tip):b.lightToast("获取下架商品异常")},function(a){})},addScorll:function(){a(window).on("scroll",function(){var b=a(window).scrollTop(),c=a(window).height(),d=document.body.scrollHeight;!e.isLoading&&!e.isAllLoad&&b+c+300>d&&(e.page+=1,e.isLoading=!0,e.getBuyList(e.page,e.pageSize))})},getBuyList:function(c,f){var g={url:b.getHost()+"/commodity/v1/getMyPublishItemList",data:{pageIndex:c,pageSize:f,orderField:"2_2"}};b.load(g).then(function(c){console.log(c),c&&0==c.code?c.data.commodityList&&c.data.commodityList.length>0?(e.renderBuyListInfo(c.data.commodityList),d.page=Math.ceil(c.data.totalCount/20),e.isLoading=!1,(!c.data.commodityList||c.data.commodityList.length<e.pageSize)&&(e.isAllLoad=!0)):1==e.page?(a(".bgview").removeClass("hide"),a(".bgview p").text("您还未发布过商品~")):b.lightToast("没有更多了"):b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("获取我发布列表异常")},function(a){})},renderBuyListInfo:function(b){b=b||[],a("body").append(c.template(a(".renderBuyListInfo").text())(b)),e.addClick()}};e.init()});