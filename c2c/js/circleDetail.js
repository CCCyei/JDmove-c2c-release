require(["jquery","utils","dot"],function(a,b,c){"use strict";var d=1,e=0,f=b.getUrlParam("circleId"),g={commodityId:"",uin:"",totalCount:"",page:"",desc:""},h={init:function(){var a=b.getParameter("lat"),c=b.isNotEmpty(b.getParameter("lon"))?b.getParameter("lon"):b.getParameter("lng");b.isNotEmpty(a)&&b.isNotEmpty(c)?(b.setCookie("lat",a),b.setCookie("lon",c)):(b.setCookie("lat",-1),b.setCookie("lon",-1)),h.getBuyList(d),h.addClick()},addClick:function(){a(".ui-tittle").click(function(){var a="",c=Number(b.getCookie("lat")),d=Number(b.getCookie("lon"));a+=c?"?lat="+c:"",a+=d?"&lon="+d:"";var e="/circleList.html"+a;b.goUrl(e)}),a(".close").click(function(){b.getType("android")?location.href="openapp.paipai://pushToHome/app":b.getType("apple")&&(location.href="openapp.paipai://pushToHome/app")}),a(".ui-box").unbind("click").bind("click",function(){g.commodityId=a(this).attr("itemid"),location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+g.commodityId+"}"}),a(".ui-hd-img").unbind("click").bind("click",function(){return g.uin=a(this).attr("uin"),location.href='openapp.paipai://pushToOthersHome/app?param={"key1":'+g.uin+"}",!1})},getBuyList:function(){var c={url:b.getHost()+"/searchCircle/getCircleCommodityList",dataType:"jsonp",data:{circleId:f,pageIndex:d,pageSize:"10"}};b.load(c).then(function(c){b.log(c),a(".circle-header").attr("background-image",getImageHost()+"/paipai/s375x140_"+c.data.esToLifeCircleVo.lifecircleImage),a("title").html(c.data.esToLifeCircleVo.lifecircleName);var f=a("body"),i=a('<iframe src="//www.jd.com/favicon.ico" style="display:none;"></iframe>');i.on("load",function(){setTimeout(function(){i.off("load").remove()},0)}).appendTo(f),a(".circleName").html(c.data.esToLifeCircleVo.lifecircleName),a(".numInfo span").html("该集市共有好物"+c.data.esToLifeCircleVo.commodityCount+"件");var j=c.data.commodityItems;(j||[]).forEach(function(a){a.pic=JSON.parse(a.pic);var b=2.9*a.pic.length+"rem";a["with"]=b}),"0"==c.code?j&&j.length>0?(d++,g.page=Math.ceil(c.data.totalCount/10),h.renderBuyListInfo(j),h.addClick(),a(window).scroll(function(){var b=a(this).scrollTop(),c=a(document).height(),f=a(this).height();if(b+f>=c){if(d==e)return;e=d,h.getBuyList(d)}})):1==d?(a(".bgview").removeClass("hide"),a(".bgview p").text("集市内没有商品哦~")):b.lightToast("没有更多了"):b.isNotEmpty(c.tip)?b.lightToast(c.tip):b.lightToast("集市详情异常")},function(a){})},renderBuyListInfo:function(b){b=b||[],a(".ui-goods-box").append(c.template(a(".renderBuyListInfo").text())(b))}};h.init()});