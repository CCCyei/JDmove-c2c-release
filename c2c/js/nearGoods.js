function showDate(a){var b=!1;return 36e3>nowDate-a/1e3&&(b=!0),b}var nowDate=0;require(["jquery","utils","dot","ext","upreport","share","fastclick"],function(a,b,c,d,e,f,g){"use strict";g.attach(document.body);var h={init:function(){a("title").html("附近好物"),h.initShareInfo(),h.setShare();var c=b.getParameter("ids")||"";e.init(c),a(".cpf-tip").addClass("cpf-tip2").removeClass("hide"),h.initScroll(),h.goScroll(),h.initPara(function(){h.req.getHeader()}),h.addClick(),h.req.getPoolItem(),3==b.getType()?(d.init(),a(".btn-public").addClass("ui-hide")):a(".btn-public").removeClass("ui-hide")},initPara:function(a){var c=b.getParameter("ids");if(b.isNotEmpty(c)){var d=c.split(",");2==d.length?(h.ids.header=d[0],h.ids.intr=d[1],h.ids.reqIds=c,a()):console.log("获取参数错误")}},ids:{header:"",intr:"",reqIds:""},isFirst:!0,timestamp:null,hasData:null,isLoading:!1,count:"",para:{kindsWidth:2e3,item:[],num:1,top:"",firstTime:0,isTop:!1,isScroll:!1,isLast:!1},addClick:function(){a(".cpf-list").undelegate(".item-heart","click").delegate(".item-heart","click",function(){var b=a(this),c=b.data("tag"),d=b.data("commentid"),e=parseInt(b.data("num")),f="";0==c?(c=1,f="image/icon_heart.png",e-=1):(c=0,f="image/icon_heart_se.png",e+=1),h.req.saveInterest(d,c,function(){b.html('<img src="'+f+'">'+e),b.data("tag",c),b.data("num",e)})}),a(".item-img-list").undelegate("ul","click").delegate("ul","click",function(){var b=a(this).children("li").data("commentid");console.log(b),location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+b+"}"}),a(".cp-floor").undelegate(".item-comment","click").delegate(".item-comment","click",function(){var b=a(this).data("commentid");location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+b+"}"}),a(".cp-floor").undelegate(".item-title","click").delegate(".item-title","click",function(){var b=a(this).data("commentid");location.href='openapp.paipai://pushToC2CDetail/app?param={"key1":'+b+"}"}),a(".btn-public .btn-tap").unbind("click").bind("click",function(){b.setDoubleClick(function(){location.href="openapp.paipai://c2cPublish/app"})}),a(".cpf-item").undelegate(".it-left img","click").delegate(".it-left img","click",function(){var b=a(this).data("uin");location.href='openapp.paipai://getUserInfo/app?param={"uin":"'+b+'"}'}),a("#scroll-banner").undelegate("a","click").delegate("a","click",function(){var b=a(this).data("href");location.href=b})},initShareInfo:function(){var a={method:"setAPPInfo",params:{type:1,title:"拍拍二手 - 附近好物",subTitle:"自主定价、信息真实、最大程度保障交易安全",shareUrl:window.location.href}};b.setAppInfo(a);var c={method:"setAPPInfo",params:{type:3}};b.setAppInfo(c)},setShare:function(){var a,c={url:window.location.href,title:"拍拍二手- 京东订单一键转卖",qzone_title:"拍拍二手- 京东订单一键转卖",wechat_title:"拍拍二手- 京东订单一键转卖",wechat_time_title:"自主定价、信息真实、最大程度保障交易安全",wechat_desc:"自主定价、信息真实、最大程度保障交易安全",qq_desc:"自主定价、信息真实、最大程度保障交易安全",qzone_desc:"自主定价、信息真实、最大程度保障交易安全",img:"https://paipai.m.jd.com/c2c/image/pai-2x.png",isCallBack:"Y"};a="h5"==b.getLoginType()?"":"jd",setTimeout(f.init(c,a),300)},initScroll:function(){window.addEventListener("scroll",function(){var a=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,c=b.setUrlParam(window.location.href,"translateY",a),d=(new Date).getTime(),e=h.para.firstTime;d-e>5e3&&(h.para.firstTime=d,history.replaceState("",document.title,c)),b.scrollLoad({loadData:function(){h.para.isLast||(h.para.num++,h.req.getPoolItem(!0))}})})},goScroll:function(){var a=b.getParameter("translateY");null!=a&&window.scrollTo(0,a)},req:{getHeader:function(){var c={url:b.getHost()+"/cms",data:{ids:h.ids.reqIds}};b.load(c).then(function(c){if(b.isNotEmpty(c)&&"0"==c.code){if(b.isNotEmpty(c.data[h.ids.header])){var d={method:"h5TitleEdit",params:{key1:c.data[h.ids.header][0].title}};b.setAppInfo(d),a("body").attr("title",c.data[h.ids.header][0].title),a(".top-image").children("img").attr("src",getImageIcon("/paipai/",c.data[h.ids.header][0].bgImg,"")),a(".img-text-1").html(c.data[h.ids.header][0].firstText),a(".img-text-1").css("color",c.data[h.ids.header][0].titleColor),a(".img-text-2").html(c.data[h.ids.header][0].secondText),a(".img-text-2").css("color",c.data[h.ids.header][0].titleColor)}b.isNotEmpty(c.data[h.ids.intr])&&(a(".cpt-text-title").html(c.data[h.ids.intr][0].title),a(".cpt-text-title").css("color",c.data[h.ids.intr][0].titleColor),a(".cpt-text-contain").html(c.data[h.ids.intr][0].introduce))}else b.isNotEmpty(c.tip)?b.lightToast(c.tip):console.log("顶部信息获取异常")},function(a){b.lightToast("网络有误 请再试一次")})},getPoolItem:function(a,c,d){b.isEmpty(a)&&(h.para.num=1,h.timestamp=null,h.hasData=null);var e=b.getParameter("lon")||-1,f=b.getParameter("lat")||-1,g={url:b.getHost()+"/search/v1/c2cNearby",data:{pageIndex:h.para.num,pageSize:10,orderField:"2_2",lon:e,lat:f,requestTime:h.timestamp,hasData:h.hasData}};b.isNotEmpty(d)&&(g.data={poolId:c,pageSize:50,pageIndex:1,flag:1}),b.load(g).then(function(a){h.isLoading=!1,nowDate=a.currentTime,console.log(a.data.requestTime),"0"==a.code?b.isNotEmpty(d)?d(a.data.commodityList):(h.render.itemList(a.data.commodityList),h.timestamp=a.data.requestTime,h.hasData=a.data.hasData,b.isEmpty(a.data.commodityList)||b.isNotEmpty(a.data.commodityList)&&0==a.data.commodityList.length?h.para.isLast=!0:h.para.isLast=!1):b.isNotEmpty(a.tip)?b.lightToast(a.tip):console.log("获取商品池信息异常")},function(a){b.lightToast("网络有误 请再试一次"),b.para.last++})},saveInterest:function(a,c,d){var e={url:b.getHost()+"/interest/save",data:{commodityId:a,isInterest:c}};b.load(e).then(function(a){"0"==a.code?(0==c&&b.lightToast("收藏成功在我的收藏查看"),b.isNotEmpty(d)&&d()):b.isNotEmpty(a.tip)?b.lightToast(a.tip):console.log("获取商品池信息异常")},function(a){b.lightToast("网络有误 请再试一次")})}},render:{pool:function(d){d=d||[],d.length>0?a("#kindsShow").html(c.template(a(".pool").text())(d)):b.log("广告数据异常"),h.setPoolSelect(),h.addClick(),a("#kindsShow").attr("clstag","pageclick|keycount|PaiPai_201712112|18")},header_text:function(b){var d=a(".img-text-1");b&&b.length>0?d?d.append(c.template(a(".itemList").text())(b)):(a(".cpf-list").html(c.template(a(".itemList").text())(b)),h.para.isTop&&window.scrollTo(0,h.para.top)):console.log("这里没有数据"),h.addClick()},itemList:function(b){b&&b.length>0?(1!=h.para.num?a(".cpf-list").append(c.template(a(".itemList").text())(b)):(a(".cpf-list").html(c.template(a(".itemList").text())(b)),h.para.isTop?(a(".cpf-list").addClass("addminheight"),h.para.isScroll=!0):a(".cpf-list").removeClass("addminheight")),a(".cpf-list").removeClass("hide"),a(".bgview").addClass("hide")):(1==h.para.num&&(a(".bgview").removeClass("hide").addClass("bgview2"),a(".cpf-list").addClass("hide"),a(".bgview p").text("你查看的商品不见了~")),console.log("这里没有数据")),h.addClick(),a(".item-heart").attr("clstag","pageclick|keycount|PaiPai_201712112|19"),a(".item-comment").attr("clstag","pageclick|keycount|PaiPai_201712112|20")}},setPoolSelect:function(){var c=b.getParameter("poolId");b.isNotEmpty(c)?a("#kindsShow li").each(function(){a(this).data("poolid")==c&&a(this).click()}):a("#kindsShow li").first().click()}};h.init(),window.onpageshow=function(a){a.persisted&&h.initShareInfo()}});